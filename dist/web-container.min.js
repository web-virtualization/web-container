!function(){"use strict";class t extends HTMLElement{constructor(){super(),this._hasInit=!1,this._hasMounted=!1,this.webContainer=null}connectedCallback(){if(!this._hasInit){if(!this.webContainer){let t=this.parentNode;for(;t;)t.webContainer&&(this.webContainer=t.webContainer),t=t.parentNode}if(!this.webContainer)return;"function"==typeof this.onInit&&this.onInit(),this._hasInit=!0,this._hasMounted||("function"==typeof this.onMount&&this.onMount(),this._hasMounted=!0)}}disconnectedCallback(){this._hasMounted&&("function"==typeof this.onUnMount&&this.onUnMount(),this._hasMounted=!1)}}class e{async onInit(){const t=this.webContainer.containerElement,e=t.getAttribute("src");if(!e)return;const n=this.webContainer.getPlugin("resourceLoader");let i=null;try{i=await n.load(e)}catch(t){console.error(t)}if(!i)return;i=i.replaceAll("<script","<wc-script").replaceAll("<\/script>","</wc-script>").replaceAll("<body","<wc-body").replaceAll("</body>","</wc-body>");const s=window.document.createElement("template");s.innerHTML=i;for(const t of s.content.querySelectorAll('link[rel="stylesheet"]')){const e=window.document.createElement("wc-style");e.setAttribute("href",t.getAttribute("href")),t.parentNode.replaceChild(e,t)}requestAnimationFrame((async()=>{t.shadowRoot.appendChild(s.content,!0),await n.load(),console.log("--- document load complete")}))}}class n{}class i{hasPermission(t){const e=this.webContainer.containerElement,n=`permission-${t}`;return e.hasAttribute(n)&&"false"!==e.getAttribute(n)}}class s{constructor(t){this.url=t.url,this.baseUrl=t.baseUrl,this.loader=t.loader,this.loadCompleted=!1,this.loadError=null,this.contentResult=null,this.loadResolveFn=null,this.loadRejectFn=null}load(){return new Promise((async(t,e)=>{if(this.loadResolveFn=t,this.loadRejectFn=e,"string"==typeof this.url)try{let t=this.baseUrl;t.endsWith("/")&&(t=t.substring(0,-2));let e=this.url;e.startsWith("./")?e=e.substr(2):e.startsWith("/")&&(e=e.substr(1));const n=await window.fetch(`${t}/${e}`);this.contentResult=await n.text(),this.loadError=null,this.loadCompleted=!0}catch(t){this.contentResult=null,this.loadError=t,this.loadCompleted=!0}else this.contentResult=null,this.loadError=null,this.loadCompleted=!0;const n=this.loader.queue;for(;n.length>0;){const t=n[0];if(!t.loadCompleted)break;n.shift(),t.loadError?t.loadRejectFn(t.loadError):t.loadResolveFn(t.contentResult)}}))}}class o{constructor(){this.queue=[]}load(t){const e=this.webContainer.containerElement.getAttribute("baseURL")||"",n=new s({url:t,baseUrl:e,loader:this});return this.queue.push(n),n.load()}}class a{constructor(t){const e=window.document;this.URL=e.URL,this.activeElement=e.activeElement,this.title=e.title,this.domain=e.domain,this.__proto__=window.document.createElement("div"),this.getElementById=e=>t.containerElement.shadowRoot.getElementById(e),this.querySelector=(...e)=>t.containerElement.shadowRoot.querySelector(...e),this.createElement=(...t)=>e.createElement(...t),this.createTextNode=(...t)=>e.createTextNode(...t),this.createEvent=(...t)=>e.createEvent(...t),this.createDocumentFragment=(...t)=>e.createDocumentFragment(...t),this.createTreeWalker=(...t)=>e.createTreeWalker(this.body,...t.slice(1)),this.implementation=e.implementation,this.documentElement=this.body}}class r extends EventTarget{constructor(t){super(),this.initStdAPIs(t),this.initStdClasses(t),this.initStdInstances(t)}postContainerMessage(t,e){t&&e&&Object.values(window.WebContainer.instances).forEach((n=>{const i=n.containerElement.getAttribute("message-topics");if(!i)return;let s=!1;s="*"===e&&"*"===i||i.includes(e),s&&("object"==typeof t&&(t=JSON.stringify(t)),window.requestAnimationFrame((()=>{const e=new Event("container-message");e.data=t,n.scriptContext.globalThis.dispatchEvent(e)})))}))}initStdAPIs(t){this.alert=(...e)=>{if(!t.permissionControl.hasPermission("alert"))throw new Error("Permission Error Of alert!");window.alert(...e)},this.assert=window.assert,this.atob=window.atob,this.btoa=window.btoa,this.cancelAnimationFrame=window.cancelAnimationFrame,this.cancelIdleCallback=window.cancelIdleCallback,this.clearInterval=window.clearInterval,this.clearTimeout=window.clearTimeout,this.confirm=window.confirm,this.customElements=window.customElements,this.fetch=window.fetch,this.getComputedStyle=window.getComputedStyle,this.getSelection=window.getSelection,this.history=window.history,this.localStorage=window.localStorage,this.matchMedia=window.matchMedia,this.moveBy=window.moveBy.bind(window),this.moveTo=window.moveTo.bind(window),this.postMessage=window.postMessage.bind(window),this.prompt=window.prompt,this.requestAnimationFrame=window.requestAnimationFrame,this.requestIdleCallback=window.requestIdleCallback,this.scrollBy=window.scrollBy,this.scrollTo=window.scrollTo,this.setInterval=window.setInterval,this.setTimeout=window.setTimeout,this.console=window.console,this.decodeURI=window.decodeURI,this.encodeURI=window.encodeURI,this.decodeURIComponent=window.decodeURIComponent,this.encodeURIComponent=window.encodeURIComponent,this.escape=window.escape,this.isFinite=window.isFinite,this.isNaN=window.isNaN,this.parseFloat=window.parseFloat,this.parseInt=window.parseInt,this.undefined=window.undefined,this.unescape=window.unescape}initStdClasses(){this.Symbol=window.Symbol,this.Node=window.Node,this.HTMLElement=window.HTMLElement,this.HTMLIFrameElement=window.HTMLIFrameElement,this.MouseEvent=window.MouseEvent,this.Text=window.Text,this.Comment=window.Comment,this.CDATASection=window.CDATASection,this.ProcessingInstruction=window.ProcessingInstruction,this.Object=window.Object,this.Document=window.Document,this.DocumentFragment=window.DocumentFragment,this.Element=window.Element}initStdInstances(t){this.document=new a(t),this.location=window.location,this.navigator=window.navigator,this.sessionStorage=window.sessionStorage,this.self=this,this.globalThis=this,this.window=this}}class l{static instances={};onInit(){this._globalThis=new r(this.webContainer)}execute(t,e){e=e||this.webContainer.containerElement.shadowRoot;const n=window.document.createElement("script");n.type="text/javascript",n.textContent=`(function(${this.formalParameters}) {\n      'use strict';\n      ${t};\n    }).apply(${this.globalThisExpress},${this.actualParametersExpress})`;try{e.appendChild(n)}catch(t){console.error(error)}}get globalThis(){return this._globalThis}get globalThisExpress(){return`window.WebContainer.instances['${this.webContainer.instanceId}'].scriptContext.globalThis`}get formalParameters(){return Object.keys(this._globalThis)}get actualParameters(){return Object.values(this._globalThis)}get actualParametersExpress(){return`window.WebContainer.instances['${this.webContainer.instanceId}'].scriptContext.actualParameters`}}class c{static instances={};constructor(t){this._isAttached=!1,this._isDisposed=!1,this._hasInit=!1,this._domContentLoaded=!1,this._containerElement=t,this._instanceId=Math.random().toString(36).substr(2,5),this._plugins=new Map}get instanceId(){return this._instanceId}init(){this._hasInit||(this.onInit(),this._plugins.forEach((t=>{"function"==typeof t.onInit&&t.onInit()})),this._hasInit=!0)}onInit(){this.containerElement.attachShadow({mode:"open"}),this.containerElement.shadowRoot.webContainer=this,this.addPlugin("documentInitiator",new e),this.addPlugin("permissionControl",new i),this.addPlugin("resourceCache",new n),this.addPlugin("resourceLoader",new o),this.addPlugin("scriptContext",new l)}get containerElement(){return this._containerElement}get attached(){return this._isActivated}get domContentLoaded(){return this._domContentLoaded}attach(){this._isDisposed||this._isAttached||(c.instances[this._instanceId]=this,this._plugins.forEach((t=>{"function"==typeof t.onAttach&&t.onAttach()})),this._isAttached=!0)}detach(){this._isDisposed||this._isAttached&&(this._plugins.forEach((t=>{"function"==typeof t.onDetach&&t.onDetach()})),this._isAttached=!1,delete c.instances[this._instanceId])}addPlugin(t,e){if(!this._isDisposed&&!this._plugins.has(t)&&e)return e.webContainer=this,this._hasInit&&"function"==typeof e.onInit&&e.onInit(),this._isAttached&&"function"==typeof e.onAttach&&e.onAttach(),this._plugins.set(t,e),this[t]=e,e}getPlugin(t){return this._plugins.get(t)}dispose(){this._isDisposed&&(this._plugins.forEach((t=>{"function"==typeof t.onDispose&&t.onDispose()})),this._plugins.clear(),this._isDisposed=!0)}}window.WebContainer=c;window.customElements.define("web-container",class extends t{constructor(){super(),this.webContainer=new c(this)}onInit(){this.webContainer.init()}onMount(){this.webContainer.attach()}onUnMount(){this.webContainer.detach()}}),window.customElements.define("wc-body",class extends t{onInit(){this.webContainer.getPlugin("scriptContext").globalThis.document.body=this}}),window.customElements.define("wc-script",class extends t{constructor(){super()}async onInit(){this.style.display="none";let t=this.textContent;if(t)this.textContent=null;else{const e=this.getAttribute("src");if(e)try{t=await this.webContainer.getPlugin("resourceLoader").load(e)}catch(t){console.error(t)}}if(!t)return;this.webContainer.getPlugin("scriptContext").execute(t,this)}}),window.customElements.define("wc-style",class extends t{async onInit(){this.style.display="none";let t=this.textContent;if(t)this.textContent=null;else{const e=this.getAttribute("href");if(e)try{t=await this.webContainer.getPlugin("resourceLoader").load(e)}catch(t){console.error(t)}}if(!t)return;const e=window.document.createElement("style");e.textContent=`${t};`,this.appendChild(e)}})}();
