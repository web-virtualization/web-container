sap.ui.define('sap/sf/surj/shell/BizXHeader.controller',['jquery.sap.global','sap/ui/Device','sap/ui/model/json/JSONModel','sap/ui/core/Fragment','sap/ui/core/Icon','sap/m/Dialog','./util/Util','./util/DeferredUtil','./util/ActionSearchUtil','./util/Logger','./util/AnimateUtil','./util/A11yPreferences','./util/SearchUtil','./util/JamUtil','./util/ShowMeUtil','./util/LinkUtil','./util/CookiePolicyUtil','./util/ProxyUtil','./util/FLPServices','./controls/BizXMenuListItem','./controls/BizXSuggestionItem','./controls/BizXMenuPopover','./controls/GlobalAssignmentMenuItem','./controls/IntroSuggestionItem','./controls/PeopleSuggestionItem','./controls/ShowMoreSuggestionItem','./controls/ResponsiveSidePanel','./controls/BizXSearchField','./core/BizXResourceModel','./quickcard/QuickcardHandler','./util/Polyfill','jquery.sap.storage','./util/PeopleSearchUtil','./library'],function($,D,J,F,I,c,U,d,A,L,f,g,S,h,k,l,C,P,m,B,n,o,G,p,q,r,R,s,t,Q){"use strict";var u=sap.ui.getCore();var v=u.getLibraryResourceBundle('sap.sf.surj.shell.i18n');var w=L.getLogger('BizXShell.controller');var T='sap.sf.todo.util.PanelManager';var x=50;var y=['ActionPeople','People','Jam','JamGroup'];var z=['TITLE','PHONE'];var E={LOGOUT:'sap-icon://log',OPTIONS:'sap-icon://action-settings',SWITCH_TO_ASSIGNMENT:'sap-icon://visits',SELECTED_ASSIGNMENT:'sap-icon://employee-approvals',HOME_ASSIGNMENT:'sap-icon://home',GLOBAL_ASSIGNMENT:'sap-icon://globe',PRIMARY_ASSIGNMENT:'sap-icon://favorite',ADMIN:'sap-icon://technical-object',FEEDBACK:'sap-icon://notification-2',PROXY_NOW:'sap-icon://citizen-connect',DEFAULT:'sap-icon://shortcut',TILE_CATALOG:'sap-icon://grid',TODO_ACTION:'sap-icon://sys-enter',SHOW_VERION_INFO:'sap-icon://hint'};var H={Action:v.getText('COMMON_ACTIONS'),CopilotAction:v.getText('COMMON_COPILOT_ACTIONS'),People:v.getText('COMMON_People')};var K=window.MSGS||{};var M={ActionPeople:{label:v.getText('COMMON_Action_or_people_search'),placeholder:v.getText('COMMON_Search_for_actions_or_people'),intro:v.getText('COMMON_Global_Action_Search_Intro')},People:{label:v.getText('COMMON_People'),placeholder:v.getText('COMMON_Search_for_people')},Jam:{label:K.COMMON_Jam_search||v.getText('COMMON_Jam_search'),placeholder:K.COMMON_Global_Jam_Search_Placeholder||v.getText('COMMON_Global_Jam_Search_Placeholder')},JamGroup:{placeholder:v.getText('COMMON_Global_Jam_Group_Search_Placeholder')}};var N={todos:'todos',notifications:'notif'};var O='side-panel';var V=3;return sap.ui.controller('sap.sf.surj.shell.BizXHeader',{onInit:function(){var a=this.mModel=u.getModel('pageHeader');if(!a&&window.pageHeaderJsonData){a=this.mModel=new J(window.pageHeaderJsonData);u.setModel(a,'pageHeader');}this._normalizeModelData(a);this._handleSapShellParam();var b=a.getProperty('/utilityLinks/links');if(!U.isRunningBaseDomain()){b=b&&b.filter(function(i){var id=i.id;return!(id=='PROXY_NOW'||id=='PROXY_BECOME_SELF');});a.setProperty('/utilityLinks/links',b);a.setProperty('/showMeInfo',null);a.setProperty('/settings/showGlobalNotification','false');if(!U.isBaseDomainCORSEnabled()&&!a.getProperty('/odataProxyUrl')){a.setProperty('/enableGlobalTodos',false);}}var e=[];var j=[];var Y=this;var Z=a.getProperty('/globalAssignmentLinks');Z&&$.each(Z,function(i,q1){var r1=$.extend({},q1);if(r1.isSelected){r1.icon=E.SELECTED_ASSIGNMENT;}else{r1.icon=E.SWITCH_TO_ASSIGNMENT;}a.setProperty('/bEmploymentDifferentiatorsFlag',r1.employeeDifferentiatorsInfo);var s1='';if(a.getProperty('/bEmploymentDifferentiatorsFlag')){s1=r1.empDifferentiators||v.getText('COMMON_Search_No_Title_Placeholder');}else{s1=r1.employeeTitle||v.getText('COMMON_Search_No_Title_Placeholder');}if(!r1.isActive){var t1=v.getText('COMMON_InActive');r1.dimmedText=' '+v.getText('COMMON_PARENTHETICAL_PHRASE',[t1]);}r1.label=s1;var u1;var v1;if(r1.isPrimaryAssignment){u1=E.PRIMARY_ASSIGNMENT;v1=v.getText('COMMON_Primary_Employment');r1.assignment='primaryAssignment';}else if(r1.isGlobalAssignment){u1=E.GLOBAL_ASSIGNMENT;v1=v.getText('COMMON_Global_Assignment');r1.assignment='globalAssignment';}else if(r1.isHomeAssignment){u1=E.HOME_ASSIGNMENT;v1=v.getText('COMMON_Home_Assignment');r1.assignment='homeAssignment';}if(v1){r1.assignmentTypeText=v1;}if(u1){r1.supplementalIcons=[{src:u1,tooltip:v1}];}Y._updateGlobalAssignmentLink(r1);if(D.system.phone){e.push(r1);}j.push(r1);if(q1.isSelected){var w1=$.extend({},q1);w1.label=Y._unescape(w1.label);a.setProperty('/selectedAssignment',w1);}});if(j.length==0){j.push({userId:a.getProperty('/userInfo/id')});}var _=a.getProperty('/enableGlobalTodos');if(_&&D.system.phone){this._todoActionPath='/actionLinks/'+e.length;e.push({id:'TODO_ACTION',icon:E.TODO_ACTION,label:'TODO_ACTION',visible:false});}a.setProperty('/activeEmployments',j);b&&$.each(b,function(i,q1){var r1=$.extend({},q1);r1.icon=E[r1.id]||E.DEFAULT;if(r1.id==='LOGOUT'){Y._prependOnClick(r1,'if (window.BizXHeaderController) {BizXHeaderController.onBeforeLogout()}');}e.push(r1);});var a1=a.getProperty('/userInfo');var b1=a1.photoSrc;if(!b1){b1={urlType:'eduPhoto',photoType:'liveProfile',mod:a1.mod};if(a1.userIdEncoded){b1.userIdEncoded=a1.userIdEncoded;}else{b1.userId=a1.id;}}a.setProperty('/userTopNav',{fullName:this._unescape(a.getProperty('/utilityLinks/label/label')),photoSrc:b1});a.setProperty('/actionLinks',e);if(window.SFGuidedTourRegistry){SFGuidedTourRegistry.register('sfGuidedTour_NavigationMenu',{id:'customHeaderModulePickerBtn'});}this.mNoResultItem=new p({introSnippet:'<div class="noSearchResults">'+v.getText('COMMON_No_Results')+'</div>'});this.mIntroItem=new p({introSnippet:'{universalSearch>/introSnippet}'});this._unescapeLabels(a,'/actionLinks');this._unescapeLabels(a,'/activeEmployments');this._initDialogPosFix();this._initSearchConfig();this._initGlobalNotificationCount();this._initShowMe();this._initTodos();this._initShowCookiePolicy();this._initSecurityPolicy();this._mouseEnterSuggestion=$.proxy(this._mouseEnterSuggestion,this);this._mouseLeaveSuggestion=$.proxy(this._mouseLeaveSuggestion,this);var c1=a.getProperty('/globalInstanceRef');var d1=this.getView();if(c1){window[c1]=window[c1]||d1;}var e1=this;d1.setModel(a,'pageHeader');d1.setModel(u.getModel('i18n')||new t,'i18n');d1.setModel(u.getModel('universalSearch'),'universalSearch');var f1=['clearAddedSubTabs','clearSubTabs','addSubTabs','getJamBaseUrl','getUrlOfSubTabWithId','setUrlOfSubTabWithId','getSubTab','setSelectedSubTab','updateJamGroupSearchInfo'];$.each(f1,function(i,q1){d1[q1]=function(){return e1[q1].apply(e1,arguments);};});if(a.getProperty('/allowEmbeddableMode')&&window.top!=window.self&&!a.getProperty('/useSimplifiedHeader')){$('body').addClass('bizXEmbeddedMode');}window.BizXHeaderController=this;this._initFooter();A.checkRedirectAction();this._initSessionTimeout();var g1=a.getProperty('/downtimeNotification');if(g1){this._initDowntime(g1);}var h1=a.getProperty('/bodyClasses');if(h1){$('body').addClass(h1);}var i1=a.getProperty('/settings');if(U.isRunningBaseDomain()&&i1){if(i1.feedBackFeatureEnabled=='true'){U.initFeedback();}if(i1.isKbaAnswerRequired=='true'){U.initKBA();}if(i1.isPwdChangeRequired=='true'){U.initPwdChange();}if(i1['ui5-content-density-support']==='true'){$('html, body').addClass(D.support.touch?'sapUiSizeCozy':'sapUiSizeCompact');}var j1=u.getConfiguration().getTheme();if(i1['sync-high-contrast-with-ui5']=='true'){$('html').addClass(j1.indexOf('sap_belize_hc')==0?'syncHighContrastWithUI5':'syncHighContrastWithUI5Off');}}if(i1&&i1.userAssistEnabled=='true'){if(U.isRunningBaseDomain()||U.isUASupportedExternalModule()){sap.ui.require(['sap/sf/userassistance/userAssistanceUtil'],function(i){i.init(i1);});}}if(U.isRunningBaseDomain()){this._handleSidePanelParam();}U.addPageInitScripts();if(i1&&i1.inProductSupportEnabled=='true'){if(U.isRunningBaseDomain()||U.isBaseDomainCORSEnabled()){U.initIPS();}}if(this._isFiori3HeaderEnabled()){$('body').addClass('fioriShellBarEnabled');}U.setHeaderController(this);if(i1&&i1.liteMode=='true'){var k1=this;var l1=a.getProperty('/pageInfo');var m1=l1.moduleId;var n1=l1.pageId;var o1=a.getProperty('/userLocale');var p1=a.getProperty('/userInfo/id');U.fetchPageNavigations({moduleId:m1,pageId:n1,language:o1,userId:p1}).then(function(i){var q1=i.modules||[];var r1=i.subTabs||[];var s1=window.pageHeaderJsonData;if(s1){s1.modules=q1;s1.subTabs=r1;}a.setProperty('/modules',q1);a.setProperty('/subTabs',r1);k1._initPageNavigations(a);}).catch(function(i){w.error(i);});}else{this._initPageNavigations(a);}},_updateGlobalAssignmentLink:function(a){if(a.url){var b='!function(u){'+'function e(){TopNavLogout.navigateAfterLoggingOutFromSPs(u)}'+'if(window.TopNavLogout){'+'e()'+'}else{'+'sap.ui.require(["sap/sf/surj/shell/util/TopNavLogout"],e,function(){window.location.href=u})'+'}'+'}('+JSON.stringify(a.url)+')';if(a.onclick){b+=';'+a.onclick;}a.onclick=b;a.url=null;}},_initPageNavigations:function(a){var b=a.getData();var e=b.modules||[];var j=-1;var Y=false;for(var i=0;i<e.length;i++){var Z=e[i];if(j<0&&Z.isSelected){j=i;}if(Z.id==='HOME'){Y=Z;}}a.setProperty('/selectedModule',j>=0?e[j]:null);a.setProperty('/title',e[j>=0?j:0].label);a.setProperty('/homeModule',Y);this._setEnableHomeIcon(a,Y);var _=b.subTabs.length;a.setProperty('/initialTabLength',_);if(_>0){for(var i=0;i<_;i++){this.registerSubTab(b.subTabs[i]);}}if(!this.isSubTabsVisible()){$('body').addClass('globalNavigationSansSubNav');}this._unescapeLabels(a,'/subTabs');this._unescapeLabels(a,'/modules');this._postMessagePageTitle(a);},_postMessagePageTitle:function(a){var b;if(m.isSupported()){b=this._getPageTitle(a);if(b){m.ShellUIService.setTitle(b);}}else if(window.PostMessageAPI){b=this._getPageTitle(a);if(b){PostMessageAPI.sendMessage('navToApp',{title:b});}}},_normalizeModelData:function(a){a.setData(d.normalizeODataResponse(a.getData()));var b=a.getProperty('/universalSearchConfig');var e={};var i=false;for(var j in b){var Y=j.substring(0,1).toUpperCase()+j.substring(1);e[Y]=b[j];i=i||Y!=j;}if(i){a.setProperty('/universalSearchConfig',e);}},_setEnableHomeIcon:function(a,b){if(!b||(!b.onclick&&!b.url)){a.setProperty('/enableHomeIcon',false);}},_getPageTitle:function(a){var b=a.getProperty('/modulePageTitle');var e=this._getSelectedItem(a.getProperty('/modules'));var i=this._getSelectedItem(a.getProperty('/subTabs'));if(!b){var j=e&&e.label;var Y=i&&i.label;if(Y==j){Y=null;}if(j&&Y){b=j+': '+Y;}else{b=Y||j;}if(!b){b=document.title.trim();var Z='SuccessFactors:';if(b.indexOf(Z)==0){b=b.substring(Z.length).trim();}}}return b;},_getSelectedItem:function(a){if(a){for(var i=0;i<a.length;i++){var b=a[i];if(b.isSelected){return b;}}}return null;},_prependOnClick:function(a,b){if(a.onclick){a.onclick=b+';'+a.onclick;}else{a.onclick=b;if(a.href||a.url){a.onclick+=';return true';}}},onAfterRendering:function(){var i=true;var a=this;var b=$('#sfLoadBlockerLayer');var e=b.length>0;var j=d.whenUI5LibraryCSSReady().done(function(){if(!i){if(e){b.hide();}else{a._$().css('visibility','visible');}}});i=false;if(j.state()=='pending'){if(e){b.css('background-color','transparent').show();}else{this._$().css('visibility','hidden');}}if(this.mModel.getProperty('/options/ultraWideHeader')){$(window).scroll($.proxy(this._adjustUltraWideHeader,this));$(window).resize($.proxy(this._adjustUltraWideHeader,this));SFBodyEventDispatcher.addResizeListener(this,'_adjustUltraWideHeader');this._adjustUltraWideHeader();}var Y=window.pageHeaderJsonData;this._testInvalidate();if(this._isFiori3HeaderEnabled()){var Z=this._adjustPlacematHeight.bind(this);$(window).resize(Z);setTimeout(Z,0);}if(!this.mModel.getProperty('/userInfo/photoEnabled')){var _=$('.surjUtilityLinksMenu span.sapMBtnContent');if(_.css('max-Width')!=_.css('width')){_.css('line-height','2.375rem');}}},_adjustPlacematHeight:function(){var a=$('div.globalPlacemat').first();if(a.length==0){return;}var b=$('div.globalFooter');var e=$('.globalHeader');var i=0;if(e.length>0){i=e.is(":visible")?e.outerHeight(true):0;}if(b.length>0){i+=b.outerHeight(true);}a.outerHeight(window.innerHeight-i,true);},adjustNameSize:function(e){if(typeof this._nameInterval=='undefined'){this._nameInterval=setInterval($.proxy(function(){var a=$('.surjUtilityLinksMenu .sapMBtnContent,.surjTopNavHeaderBar .surjUserPhotoName');var b=parseInt(a.css('max-height'));if(!isNaN(b)){clearInterval(this._nameInterval);this._nameInterval=undefined;var i=a[0];var j=13;while(i.scrollHeight>i.offsetHeight&&j>10){a.css('font-size',j+'px');j--;}}},this),10);}},_testInvalidate:function(){if(!this._hasInvalidated&&!$('body').hasClass('bizXEmbeddedMode')){this._hasInvalidated=true;var a=this.getView();setTimeout(function(){if($('.sapMBarLeft',a.$()).css('width')=='0px'){a.invalidate();}},100);}},_onAfterRenderingNotification:function(){var i=$.sap.getObject('jamApp.InboxPopover');if(i&&i.bindNotificationBellEvent){i.bindNotificationBellEvent('#current-user-notification-count');this.disableGlobalNotificationButtonClick();}var a=u.byId('current-user-notification-count');if(a){a.$().attr({'aria-expanded':false,'aria-controls':'globalNotificationPanel'});}},_adjustUltraWideHeader:function(){var e=this._$();var a=$('#bizXHeaderPlaceholder');if(a.length==0){var b=e.offset();this._iTopOffset=b.top;this._iLeftOffset=b.left;if(u.getConfiguration().getRTL()){this._iLeftOffset+=$("body").prop("scrollWidth")-$(window).width();}this._iHorizMargin=this._iLeftOffset*2-e.outerWidth()+e.innerWidth();a=$('<div id="bizXHeaderPlaceholder"></div>').css({height:e.outerHeight()+'px'}).insertBefore(e);}var i=($(window).width()-this._iHorizMargin-f.getHtmlOffset())+'px';e.css({position:'fixed',top:(this._iTopOffset-$(window).scrollTop())+'px',width:i});$('#globalHeaderFullWidthBackground').css({left:$(window).scrollLeft()+'px',width:i});},isLegacyEscaped:function(){return this.mModel.getProperty('/legacyEscaped')},_unescape:function(a){return this.isLegacyEscaped()?$('<div>'+a+'</div>').text():a;},_unescapeLabels:function(a,b){if(this.isLegacyEscaped()){var e=a.getProperty(b);for(var i=0;i<e.length;i++){var j=e[i];var Y=this._unescape(j.label);var Z=this._unescape(j.title);var _=b+'/'+i+'/';a.setProperty(_+'label',Y);a.setProperty(_+'title',Z);}}},_initSearchConfig:function(){var a=this.mModel.getProperty('/universalSearchConfig')||{};this.getView()._universalSearchConfig=a;var b=S.createThrottle();b.attachEvent('pageReady',$.proxy(this.showSearchResultPage,this));b.attachEvent('error',$.proxy(this.showSearchError,this));b.attachEvent('pending',$.proxy(this.showSearchPending,this));this.mSearchThrottle=b;this._initSearchTypeItems();},_initSearchTypeItems:function(){var a=this.mModel.getProperty('/universalSearchConfig')||{};var b={};var e=[];var i=null;var j=0;var Y=false;if(!U.isRunningBaseDomain()){var Z=a.ActionPeople;var _=Z&&Z.searchEnabled;var a1=a.People;if(U.isBaseDomainCORSEnabled()){if(!_&&a1){a1.searchEnabled=a1.searchEnabled||_;a1.autoCompletionEnabled=false;}}else{if(_){Z.searchEnabled=false;}if(a1){a1.searchEnabled=a1.searchEnabled||_;a1.autoCompletionEnabled=false;}}}y.forEach(function(c1){var d1=a[c1];if(!d1){if(c1=='JamGroup'){var e1=h.getDefaultGroupId();d1=$.extend({},a.Jam,{groupId:e1,label:h.getDefaultGroupLabel(),searchEnabled:e1!=null});}else{d1={searchEnabled:false};}}if(c1=='People'&&d1.searchEnabled&&a.ActionPeople&&a.ActionPeople.searchEnabled){d1.searchEnabled=false;}if(d1.searchEnabled){var f1=c1!='JamGroup'||!!d1.groupId;if(f1){j++;}e.push({searchType:c1,label:d1.label||M[c1].label||'???',visible:f1});if(d1.selectedByDefault){i=c1;}}if(d1.searchEnabled){Y=true;}b[c1]=d1;});if(!i&&e.length>0){i=e[0].searchType;}this.mDefaultSearchType=i;$.extend(b,{searchEnabled:Y,externalSearchText:v.getText('ACTIONSEARCH_Employee_Directory'),searchTypeItems:e,searchTypeVisible:j>1});var b1=u.getModel('universalSearch');if(b1){b1.setData(b);}else{u.setModel(new J(b),'universalSearch');}if(Y){this.resetSearch();}},updateJamGroupSearchInfo:function(){this._initSearchTypeItems();},clearSearch:function(){var a=u.getModel('universalSearch');a.setProperty('/filter','');},reset:function(){var a=u.getModel('universalSearch');var b=a.getProperty('/transitiveAction');a.setProperty('/filter','');if(b!=null){this.resetSearch('ActionPeople');}else{this.resetSearch(a.getProperty('/searchType'));}},resetSearch:function(a){a=a||this.mDefaultSearchType;this.mSearchThrottle.abort();var b=u.byId('bizXSearchField');var e=M[a];var i=u.getModel('universalSearch');var j=e?e.placeholder:"";var Y=a?(a.indexOf('Transitive')==0):false;if(a=='JamGroup'){var Z=i.getProperty('/JamGroup/label');j=jQuery.sap.formatMessage(j,[Z]);}if(Y){var _=i.getProperty('/transitiveAction');j=_&&_.actionLabel;}var a1={query:'',searchType:a,placeholder:j,tooltip:j,externalSearchVisible:false};if(!Y){$.extend(a1,{transitiveAction:null});}for(var b1 in a1){i.setProperty('/'+b1,a1[b1]);}this._showAllClicked=false;var c1=this.getMinimumFilterLength();var d1={ActionPeople:'COMMON_ActionSearch_AutoComplete_A11y',Action:'COMMON_ActionSearch_AutoComplete_A11yActions',People:'COMMON_ActionSearch_AutoComplete_A11yPeople'}[a]||'COMMON_ActionSearch_AutoComplete_A11yGeneric';var e1=v.getText(d1,[c1]);var f1=null;var g1=!i.getProperty('/transitiveAction');if(g1&&b&&b._oSuggest&&b._oSuggest.isOpen()&&this._hasResults&&!this._quickcardFocused){f1=e1;}this._hasResults=false;i.setProperty('/a11yAnnouncement',f1);i.setProperty('/enableSuggestions',this.isAutoCompleteEnabled());i.setProperty('/enableExternalSearch',this.isExternalSearchEnabled());i.setProperty('/minimumFilterLength',c1);i.setProperty('/a11yLabel',e1);if(g1&&b){b.removeAllSuggestionItems();var h1=e?e.intro:null;if(h1){if(g.isKeyboardOnlyNavigationEnabled()){h1='<div class="globalActionSearchIntro actionSearchA11yInstruction">'+e1+'</div>'+h1;}i.setProperty('/introSnippet',h1);b.addSuggestionItem(this.mIntroItem);}}if(b&&b._oSuggest){b._oSuggest.setHighlightedExternalSearch(false);}},afterSuggestClose:function(){setTimeout($.proxy(function(){if(!this._quickcardFocused){this.getQuickcardHandler().hideActiveQuickcard();}},this),10);},isExternalSearchEnabled:function(){var a=u.getModel('universalSearch');var b=a.getProperty('/searchType');return!this.isAutoCompleteEnabled()||(b&&b.indexOf('Jam')==0);},isAutoCompleteEnabled:function(){var a=u.getModel('universalSearch');var b=a.getProperty('/searchType');if(b=='ActionPeople'||a.getProperty('/transitiveAction')){return true;}var e=a.getProperty('/'+b);return e&&e.autoCompletionEnabled;},isShowQuickcardOnSelect:function(){var a=u.getModel('universalSearch');var b=a.getProperty('/searchType');var e=a.getProperty('/'+b);return e&&e.showQuickcardOnSelect;},getMinimumFilterLength:function(){var a=u.getModel('universalSearch');var b=a.getProperty('/searchType');if(a.getProperty('transitiveAction')){b='ActionPeople';}var e=a.getProperty('/'+b);return(e&&e.allowOneCharQuery)?1:2;},openSearchSuggestion:function(){if(this.isAutoCompleteEnabled()){u.byId('bizXSearchField').suggest(true);}else{var a=this;var b=new s({resetOnBlur:true,showRefreshButton:true,showSearchButton:false,value:'{universalSearch>/filter}',placeholder:'{universalSearch>/placeholder}',tooltip:'{universalSearch>/tooltip}',enableExternalSearch:true,externalSearch:[this.externalSearch,this],enableSuggestions:false,showSearchType:'{universalSearch>/searchTypeVisible}',pressSearchType:[this.showSearchType,this]});var e=new c('BizXSearchDialog-autocompleteDisabled',{showHeader:false,content:b,afterOpen:function(){b.focus();},afterClose:function(){e.destroy();},buttons:[new sap.m.Button({text:v.getText('COMMON_Cancel'),press:function(){e.close();}}),new sap.m.Button({text:v.getText('COMMON_Ok'),press:function(){a.externalSearch();e.close();}})]});e.setParent(this.getView());e.open();}},pressJobPicker:function(e){var i=this.mModel.getProperty("/bEmploymentDifferentiatorsFlag");var j=i?'empDiffTextForSwitcher':'';var Y=i?'supplementalIconForSwitcher':'';this.showMenu(e.getSource(),{menuStyleClass:'gaMenuItems',from:'end',itemPath:'pageHeader>/activeEmployments',showArrow:true,showIcons:true,showHeader:true,title:v.getText('COMMON_Current_Employments'),menuItemTemplate:new G({templateShareable:true,icon:'{pageHeader>icon}',label:'{pageHeader>label}',url:'{pageHeader>url}',onclick:'{pageHeader>onclick}',secondaryText:{parts:[{path:'pageHeader>subtitle'}],formatter:function(a){if(i){return"";}return a;}},tooltip:{parts:[{path:'pageHeader>label'},{path:'pageHeader>assignmentTypeText'}],formatter:function(a,b){if(i){if(b==undefined){return a;}else{return a+" "+b;}}return null;}},dimmedText:'{pageHeader>dimmedText}',assignmentTypeText:'{pageHeader>assignmentTypeText}',supplementalIcons:{path:'pageHeader>supplementalIcons',template:new I({templateShareable:true,decorative:false,src:'{pageHeader>src}',tooltip:{parts:[{path:'pageHeader>tooltip'}],formatter:function(a){if(i){return null;}return a;}}}).addStyleClass(Y)}}).addStyleClass(j)});},search:function(e){},searchSuggest:function(e){var a=u.getModel('universalSearch');var b=a.getProperty('/searchType');var i=a.getProperty('/transitiveAction');var j=a.getProperty('/filter');var Y=u.byId('bizXSearchField');if(b=='ActionPeople'&&i){b='TransitiveAction';a.setProperty('/searchType',b);}j=j&&j.trim();if(j&&j.length>=a.getProperty('/minimumFilterLength')){if(this.isAutoCompleteEnabled()){var Z=u.byId('surjTopNavSearchResults');var _=i&&i.actionId;var a1={searchValue:j,maxresults:10,keys:z};if(_){a1.actionId=_;a1.queryType=this._getTransitiveSearchType(i);}if(b=='JamGroup'){a1.groupId=h.getDefaultGroupId();}a.setProperty('/query',j);a.setProperty('/externalSearchVisible',false);Y.removeAllSuggestionItems();this.mSearchThrottle.change(b,a1);}else{this.externalSearch();}}else if(!i){this.resetSearch(b);}Y._oSuggest&&Y._oSuggest.setSelected(-1);},_getTransitiveSearchType:function(){return'people';},_createCrossOriginSidePanel:function(a){var b=a.panel_title;var e=a.panel_type;var i=a.button_selector;var j=U.ensureBaseDomain("/sf/home?"+O+"="+e);var Y;switch(e){case N.todos:Y="COMMON_CROSS_ORIGIN_Go_to_Todos";break;case N.notifications:Y="COMMON_CROSS_ORIGIN_Go_to_Notifications";break;default:}var Z=this.getView();var _=this;return new Promise(function(a1,b1){sap.ui.require(['sap/m/MessagePage','sap/m/Button'],function(c1,d1){var e1=new R({top:_._getHeaderHeight(),from:'end',refocusRef:u.byId(i),content:new c1({title:b,icon:"sap-icon://generate-shortcut",text:"",description:v.getText("COMMON_FUTURE_Feature_Support"),buttons:[new d1({text:v.getText("COMMON_Go_Now"),press:function(){l.handle({url:j})},tooltip:Y?v.getText(Y):"",})]})});e1.setParent(Z);a1(e1,b1);});});},_createSuggestionItem:function(a,i,b,e,j){var Y=null;switch(a){case'Jam':Y=new n({text:i.Name,highlightedText:'{universalSearch>/query}'});var Z=i.CssClass;if(Z){Y.setCustomCss(i.CssClass);}else{Y.setIcon(i.ImgUrl);}break;case'Action':case'CopilotAction':Y=new n({text:i.actionLabel,highlightedText:'{universalSearch>/query}'});break;case'People':Y=new q({user:i,highlightedText:'{universalSearch>/query}',enablePhoto:this._enablePhoto&&i.photoViewable});break;case'showMore':var _;var a1=i.totalCount-i.items.length;switch(i.type){case'People':_=a1>100?v.getText('COMMON_Show_100_more_people'):v.getText('COMMON_Show_x_more_people',a1);break;case'Action':case'CopilotAction':_=a1>100?v.getText('COMMON_Show_100_more_actions'):v.getText('COMMON_Show_x_more_actions',a1);break;}Y=new r({text:_});break;}if(Y.setSectionTitle){Y.setSectionTitle(b);}if(Y){Y.__itemType=a;Y.__item=i;Y.__activeIndex=e;Y.__totalCount=j;}return Y;},showSearchResultPage:function(e){var a=this.oSearchResultsParams=e.getParameters();var b=a.items;var Y=u.getModel('universalSearch');var Z=this;var _=u.byId('bizXSearchField');var a1=a.itemOffset;var b1=false;var c1=$('#autocomplete\\.enablePhotoForActionSearchAndQuickcard');if(c1.length>0){this._enablePhoto=(c1.attr('content')!='false');}else{var d1=window.pageHeaderJsonData;var e1=d1&&d1.settings;this._enablePhoto=!e1||e1['autocomplete.enablePhotoForActionSearchAndQuickcard']!=='false';}$.each(b,function(i,o1){if(o1.items){var p1=H[o1.type];$.each(o1.items,function(j,s1){var q1=a1+j;var r1=o1.type;if(r1=='People'){b1=true;}_.addSuggestionItem(Z._createSuggestionItem(r1,s1,j==0?p1:null,q1,o1.totalCount));});if(o1.hasMore){_.addSuggestionItem(Z._createSuggestionItem('showMore',o1,null));}}else{var q1=a1+i;var r1=a.type;if(r1=='People'){b1=true;}_.addSuggestionItem(Z._createSuggestionItem(r1,o1,null,q1,a.totalCount));}});var f1=Y.getProperty('/searchType');var g1=f1.indexOf('People')>=0&&b1;if(b.length==0&&a.first){_.addSuggestionItem(this.mNoResultItem);}Y.setProperty('/externalSearchVisible',g1);_.suggest(true);var h1=Y.getProperty('/transitiveAction');var i1=null;var j1=a.response;var k1=false;if(j1&&j1.showingMore){var i1=v.getText({People:'COMMON_GlobalSearch_Announcement_Showing_More_People',Action:'COMMON_GlobalSearch_Announcement_Showing_More_Actions',CopilotAction:'COMMON_GlobalSearch_Announcement_Showing_More_CopilotActions',}[a.type]||'COMMON_GlobalSearch_Announcement_Showing_More_Items',[a.totalCount]);i1=v.getText('COMMON_GlobalSearch_Count_Summary',[i1]);Y.setProperty('/a11yAnnouncement',i1);setTimeout(function(){var i=_._oSuggest.getList();if(i){i.selectByIndex(j1.items.length-1,false);}},100);}else if(a.first){var l1=a.totalCount;if(l1==undefined){var m1={};l1=0;$.each(b,function(i,j){var o1=j.type;var p1=j.totalCount;var q1=j.items&&j.items.length;l1+=p1;m1[j.type]=v.getText('COMMON_GlobalSearch_Announcement_'+o1+(q1==1?'_Singular':'_Plural')+(p1>q1?'_Limited':''),[p1,q1]);});if(l1==0){i1=v.getText('COMMON_GlobalSearch_Announcement_NoResults');k1=true;}else if(a.type=='ActionPeople'){i1=(m1.CopilotAction?v.getText('COMMON_GlobalSearch_Announcement_ActionCopilotPeople',[m1.Action,m1.CopilotAction,m1.People]):v.getText('COMMON_GlobalSearch_Announcement_ActionPeople',[m1.Action,m1.People]));}else{i1=v.getText('COMMON_ComboBox_Aria_Item_Count_Announcement',[l1]);}}else if(l1>0){var n1={People:'COMMON_GlobalSearch_Announcement_People',Action:'COMMON_GlobalSearch_Announcement_Action',CopilotAction:'COMMON_GlobalSearch_Announcement_CopilotAction'}[a.type];if(n1){n1+=l1==1?'_Singular':'_Plural';}i1=v.getText(n1||'COMMON_ComboBox_Aria_Item_Count_Announcement',[l1]);if(h1){i1=this._getTransitiveSearchType(h1)=='people'?v.getText('COMMON_GlobalSearch_Announcement_Transitive_Action_Person',[i1,h1.actionLabel]):v.getText('COMMON_GlobalSearch_Announcement_Transitive_Action',[i1,h1.actionLabel]);}else{i1=v.getText('COMMON_GlobalSearch_Count_Summary',[i1]);}}else{i1=v.getText('COMMON_GlobalSearch_Announcement_NoResults');k1=true;}}if(i1){Y.setProperty('/a11yAnnouncement',i1);}if(!k1){this._hasResults=true;setTimeout(function(){if(_._oSuggest){var i=_._oSuggest.getList();if(i){var j=i.$().find('.bizXSuggestionItem');j.unbind('mouseenter',Z._mouseEnterSuggestion);j.bind('mouseenter',Z._mouseEnterSuggestion);j.unbind('mouseleave',Z._mouseLeaveSuggestion);j.bind('mouseleave',Z._mouseLeaveSuggestion);}}},100);}if(a.hasMore){setTimeout(function(){Z._checkScroll();},100);}},getQuickcardHandler:function(){if(!this._quickcardHandler){this._quickcardHandler=new Q();}return this._quickcardHandler;},focusQuickcard:function(e){this._quickcardFocused=true;var a=(e&&e.getSource())||u.byId('bizXSearchField');var b=this;var i=this.getQuickcardHandler();function j(){b._quickcardFocused=false;i.removeQuickcardHiddenCallback(j);a.focus();}i.addQuickcardHiddenCallback(j);i.focusQuickcard();},highlightExternalSearch:function(){var a=u.getModel('universalSearch');a.setProperty('/a11yAnnouncement',v.getText('COMMON_GlobalSearch_Announcement_Press_Enter_Directory_Search'));this.getQuickcardHandler().hideActiveQuickcard();},quickcardRequest:function(a){if(a&&a.getParameters){a=a.getParameters();}if(!D.system.phone){var b=a.suggestionItem;var e=b.__itemType;var i=b.__item;var j=b.__activeIndex;var Y=b.__totalCount;if(!a.noAnnouncement){var Z=u.getModel('universalSearch');Z.setProperty('/a11yAnnouncement','');var _=Z.getProperty('/transitiveAction');var a1=e=='People';var b1,c1,d1;if(b.getA11yAnnouncement){b1=b.getA11yAnnouncement();}if(!b1){b1=b.getSuggestionText();}if(_){var e1=[_.actionLabel];c1=a1?v.getText('COMMON_GlobalSearch_Announcement_Select_Transitive_Person',e1):v.getText('COMMON_GlobalSearch_Announcement_Select_Transitive',e1);}else if(e=='showMore'){c1={Person:v.getText('COMMON_GlobalSearch_Announcement_Press_Enter_Show_All_People'),Action:v.getText('COMMON_GlobalSearch_Announcement_Press_Enter_Show_All_Actions'),CopilotAction:v.getText('COMMON_GlobalSearch_Announcement_Press_Enter_Show_All_CopilotActions')}[i.type]||v.getText('COMMON_GlobalSearch_Announcement_Press_Enter_Show_All_Items');}else{c1={People:v.getText('COMMON_GlobalSearch_Announcement_Press_Enter_Person'),Action:v.getText('COMMON_GlobalSearch_Announcement_Press_Enter_Action'),CopilotAction:v.getText('COMMON_GlobalSearch_Announcement_Press_Enter_CopilotAction')}[e]||v.getText('COMMON_GlobalSearch_Announcement_Press_Enter_Item');}if(e=='showMore'){d1=v.getText('COMMON_GlobalSearch_Announcement_Selected_ShowMore',[b1,c1]);}else{var e1=[b1,j+1,Y,c1];d1={People:v.getText('COMMON_GlobalSearch_Announcement_Selected_Person',e1),Action:v.getText('COMMON_GlobalSearch_Announcement_Selected_Action',e1),CopilotAction:v.getText('COMMON_GlobalSearch_Announcement_Selected_CopilotAction',e1)}[e]||v.getText('COMMON_GlobalSearch_Announcement_Selected_Item',e1);}Z.setProperty('/a11yAnnouncement',d1);}return this.getQuickcardHandler().showQuickcardForSuggestion({type:e,item:i,suggestionItem:b,itemIndex:a.itemIndex,origin:a.origin,immediate:a.immediate,fromHeader:true,a11yAnnouncements:a.noAnnouncement?null:{focused:v.getText('COMMON_GlobalSearch_Announcement_Quickcard_Focused'),available:v.getText('COMMON_GlobalSearch_Announcement_Quickcard_Available')}});}return $.Deferred().reject();},_mouseEnterSuggestion:function(e){var a=e.currentTarget;var b=u.byId(a.id);var i=this;if(this.mQuickcardRequest){this.mQuickcardRequest.cancel();}this.mQuickcardRequest=this.quickcardRequest({suggestionItem:b,noAnnouncement:true}).always(function(){i.mQuickcardRequest=null;});},_mouseLeaveSuggestion:function(e){this.mQuickcardRequest&&this.mQuickcardRequest.cancel();},_checkScroll:function(){if(this._isScrolledBottom()){this.mSearchThrottle.more();}},_isScrolledBottom:function(){if(this._oScrollDelegate){var i=this._oScrollDelegate.getScrollTop();var a=this._oScrollDelegate.getMaxScrollTop();return a-i<x;}return false;},setSearchScrollDelegate:function(e){var a=e.getParameter('scrollDelegate');this._oScrollDelegate=a;a.setGrowingList($.proxy(this._checkScroll,this));},showSearchError:function(e){var a=u.getModel('universalSearch');var b=u.byId('bizXSearchField');var i=v.getText('COMMON_AJAX_DEFAULT_ERROR');var j=e.getParameters();var Y=j&&j.response;if(Y&&typeof Y!='string'&&typeof Y[0]=='string'){if(Y[1]&&Y[1].statusText=="Unauthorized"){Y=K.COMMON_SESSION_EXPIRED_MESSAGE_DETAILS||v.getText('COMMON_SESSION_EXPIRED_MESSAGE_DETAILS');}else{Y=Y[0];}}if(typeof Y=='string'){i=Y;}a.setProperty('/introSnippet','<div class="noSearchResults">'+i+'</div>');b.addSuggestionItem(this.mIntroItem);b.suggest(true);},showSearchPending:function(e){var a=u.getModel('universalSearch');var b=e.getParameter('pending');w.info('GlobalSearch pending: '+b);a.setProperty('/pending',b);},externalSearch:function(){var a=u.getModel('universalSearch');var b=a.getProperty('/filter');if(b&&b.length>1){var e=a.getProperty('/searchType');var i={searchValue:b};if(e=='ActionPeople'){e='People';}if(e=='JamGroup'){i.groupId=h.getDefaultGroupId();}S.externalSearch(e,i);}},selectSearchTypeItem:function(e){var a=e.getSource();var b=a.getBindingContext('universalSearch').getProperty('searchType');this.resetSearch(b);},selectSuggestItem:function(e){var a=this;var b=e.getParameter('selectedItem');var j=b.__itemType;var Y=b.__item;var Z=b.__activeIndex;if(Y){var _=u.getModel('universalSearch');var a1=u.byId('bizXSearchField');if(j=='showMore'){this._showAllClicked=true;a1.removeAllSuggestionItems();_.setProperty('/externalSearchVisible',false);_.setProperty('/filter',_.getProperty('/query'));this.mSearchThrottle.change(function(){return $.Deferred().resolve($.extend({showingMore:true},Y));},{searchValue:_.getProperty('/query')});}else if(j=='Jam'){window.location.href=Y.Href;}else{var b1=_.getProperty('/transitiveAction');var c1=null;if(b1){j='Action';c1=Y;Y=b1;}if(j=='Action'&&Y.transitive&&!c1){_.setProperty('/searchType','TransitiveAction');_.setProperty('/transitiveAction',Y);_.setProperty('/filter','');_.setProperty('/placeholder','');a1.removeAllSuggestionItems();a1.focus();}else{var d1=this.oSearchResultsParams.totalCount;if(this.oSearchResultsParams.type=='ActionPeople'){var e1=this.oSearchResultsParams.items;$.each(e1,function(i,Y){if(Y.type===j){d1=Y.totalCount;return false;}});}if(this.isShowQuickcardOnSelect()&&j=='People'){this.quickcardRequest({suggestionItem:b,immediate:true}).done(function(){a.focusQuickcard();});}else{a1.suggest(false);S.selectItem(j,{item:Y,subject:c1,criteria:this.oSearchResultsParams.criteria,totalCount:d1,showAllClicked:this._showAllClicked,activateIndex:Z,actionArgs:Y.actionArgs});}}}}},navigate:function(e){var a=e.getSource();if(a instanceof sap.m.SelectList||a instanceof sap.m.List){a=a.getSelectedItem();}var b=a.getBindingContext('pageHeader').getObject();if(b.id=='TODO_ACTION'){this.showTodoPanel();}else{l.handle(b);}},navigateToHome:function(){var a=this.mModel.getProperty('/homeModule');if(a){l.handle(a);}},getCompanyLogoAlignment:function(){var a=$('<div id="globalLogoPositionRevealer"></div>').appendTo('body');var b=a.css('left');a.remove();if(this._isFiori3HeaderEnabled()&&b=='0px'){b='-1px';}return{'-1px':'Left','0px':'Middle','1px':'Right'}[b];},detectThemeChanges:function(){var a=u.byId('bizXHeaderCompanyLogo');var b=u.byId('bizXShellCustomHeader');this.insertCompanyLogo(b,a);},insertCompanyLogo:function(a,b){switch(this.getCompanyLogoAlignment()){case'Middle':a.addContentMiddle(b);break;case'Left':a.insertContentLeft(b,0);break;default:a.addContentRight(b);break;}},_initJamNotificationCount:function(){var a=new J();var j=h.isEnabled();var b=false;a.setProperty('/visible',j&&!b);if(j){h.getNotificationCount().progress(function(e){a.setProperty('/newCount',e);});}u.setModel(a,'jamNotification');},_initGlobalNotificationCount:function(){var a=this;sap.ui.require(['sap/sf/notification/util/Util'],function(b){if(!b){jQuery.sap.log.error('Cannot load NotificationUtil.');return;}var e=b.getNotificationModel();var i=b.isNotificationEnabled();e.setProperty('/visible',i);if(i){b.getGlobalCount().done(function(j){e.setProperty('/newCount',j);a._initJamNotificationCount();});}else{a._initJamNotificationCount();}},function(e){jQuery.sap.log.error('Cannot load notification ui5 module.',e);});},disableGlobalNotificationButtonClick:function(){this._overrideGlobalNotificationClick=true;},toggleGlobalNotificationPanel:function(){if(!this._hasGlobalNotificationClickBeenOverridden()){if(U.isRunningBaseDomain()||U.isBaseDomainCORSEnabled()){sap.ui.require(['sap/sf/notification/util/Util'],function(b){b.togglePanel();});}}var a=u.byId('current-user-notification-count');if(a){a.$().attr('aria-expanded',true);}},_hasGlobalNotificationClickBeenOverridden:function(){if(this._overrideGlobalNotificationClick){return true;}var a=$('#current-user-notification-count').find('[onclick]');if(a.length>0){var b=a.attr('onclick');b=b&&b.toString();if(b.indexOf('return false')>=0){return true;}}return false;},showModulePicker:function(e){this.showMenuOrSidePanel(e.getSource(),{menuStyleClass:'moduleDropDownPopup',from:'begin',itemPath:'pageHeader>/modules',sidePanelItemTemplate:new sap.m.StandardListItem({icon:'{pageHeader>icon}',title:'{pageHeader>label}'}).addStyleClass('globalMenuItem'),menuItemTemplate:new B({label:'{pageHeader>label}',url:'{pageHeader>url}',onclick:'{pageHeader>onclick}',target:{parts:[{path:'pageHeader>newWindow'}],formatter:function(b){return b==true?"_blank":null;}}})});},showUtilityLinks:function(e){var a=this.mModel.getProperty('/actionLinks');if(a==null||a.length==0){return;}var b=e.getSource();var i=this._isFiori3HeaderEnabled();var j={label:'{pageHeader>label}',url:'{pageHeader>url}',onclick:'{pageHeader>onclick}',target:'{pageHeader>target}',visible:{parts:[{path:'pageHeader>visible'}],formatter:function(Y){return Y!==false;}}};if(i){j.icon='{pageHeader>icon}';}this.showMenuOrSidePanel(b,{showArrow:i,showHeader:i,header:'{pageHeader>/userTopNav/fullName}',from:'end',itemPath:'pageHeader>/actionLinks',contentMinWidth:b.$().width()+'px',sidePanelItemTemplate:new sap.m.StandardListItem({icon:'{pageHeader>icon}',title:'{pageHeader>label}',description:'{pageHeader>dimmedText} ',info:'{pageHeader>assignment}',visible:{parts:[{path:'pageHeader>visible'}],formatter:function(Y){return Y!==false;}}}).addStyleClass('globalMenuItem').addEventDelegate({onAfterRendering:function(Y){var Z=Y.srcControl;var _=Z.getProperty('info');Z.addStyleClass(_);}}),menuItemTemplate:new B(j),menuStyleClass:'utilityLinksMenuPopover'});},updateUtilityLinkVisibility:function(a,b){var e=this.mModel.getProperty('/actionLinks');e&&e.forEach(function(i){if(i.id===a){i.visible=b;}});},showSearchType:function(e){var a=e.getSource();this.showMenu(a,{from:'end',itemPath:'universalSearch>/searchTypeItems',listItemTemplate:new B({type:'Active',label:'{universalSearch>label}',press:[this.selectSearchTypeItem,this]})});},showMenu:function(a,b){var i=a.getId()+'-menuPopover';var e=u.byId(i);if(!e){var j=b.menuItemTemplate||b.listItemTemplate;j.addEventDelegate({onclick:function(Y){var Z=100;setTimeout(function(){e.close();},Z);},ontap:function(Y){return false;}});e=new o(i,{from:b.from,title:b.header,showHeader:!!b.showHeader,showArrow:!!b.showArrow,placement:b.placement||'Bottom',beforeOpen:function(){var Y=a.$();Y.children('.sapMBtnInner').addClass('globalModulePickerActive');Y.attr('aria-expanded','true');a.addStyleClass('bizXMenuShown');b.beforeOpen&&b.beforeOpen.apply(b,arguments);},afterClose:function(){setTimeout(function(){var Y=a.$();Y.children('.sapMBtnInner').removeClass('globalModulePickerActive');a.removeStyleClass('bizXMenuShown');Y.attr('aria-expanded','false');$('#customHeaderModulePickerBtn').attr('aria-expanded',false);},100);b.afterClose&&b.afterClose.apply(b,arguments);},content:new sap.m.List({backgroundDesign:'Transparent',items:{path:b.itemPath,template:j}})});e.addStyleClass('globalHumanistText');if(b.menuStyleClass){e.addStyleClass(b.menuStyleClass);}e.setParent(this.getView());}if(e.isOpen()||a.hasStyleClass('bizXMenuShown')){e.close();}else{e.openBy(a);}},showSidePanel:function(a,b){var i=a.getId()+'-sidePanel';var e=u.byId(i);if(!e){var j=new sap.m.ScrollContainer({vertical:true,horizontal:false,width:'100%',height:'100%'});var Y=new sap.m.List({backgroundDesign:'Transparent',headerText:b.header,mode:'SingleSelectMaster',select:[function(Z){e.hide();this.navigate(Z);Y.removeSelections();},this],items:{path:b.itemPath,template:b.sidePanelItemTemplate}}).addStyleClass('globalMenu');Y.addEventDelegate({onAfterRendering:function(){$('#'+this.getId()).find(':not(:has(*))').addClass('leaf');}},Y);j.addContent(Y);e=new R(i,{top:this._getHeaderHeight(),from:b.from,content:j}).addStyleClass('bizxHeaderSidePanel');e.setParent(this.getView());}if(e.isShown()){e.hide();}else{e.show();}},showMenuOrSidePanel:function(a,b){var e=$('html').hasClass('sapUiMedia-StdExt-Phone');this[e?'showSidePanel':'showMenu'](a,b);},pressProductSwitcher:function(e){if(!this._fragPromise){this._fragPromise=Promise.all([F.load({name:"sap.sf.surj.shell.fragments.ProductSwitcher",controller:this}),this.getSapProducts()]).then(function(b){return b[0].setModel(new J({products:b[1]}));});}var a=e.getSource();this._fragPromise.then(function(b){b.isOpen()?b.close():b.openBy(a);}).catch(function(b){w.error(b);sap.ui.require(['sap/m/MessageBox'],function(i){i.error(v.getText('COMMON_AJAX_DEFAULT_ERROR'));});});},getSapProducts:function(){var a=this.getSessionStorage();var b=a&&a.get('SapProducts-'+this.mModel.getProperty('/userLocale'));if(b){return Promise.resolve(b);}return new Promise(function(e,i){d.invokeODataService({baseUrl:'/odata/v2/restricted/_PageMetaData_/',serviceName:'getSapProducts'}).then(function(j){e(j.SapProducts.products.results);},i);});},openURL:function(a){if(a&&a.trim()!==''){sap.m.URLHelper.redirect(a,true);}},_initShowMe:function(){k.init();},_initDialogPosFix:function(){var a=c.prototype._calcCenter;if(a){$('body').addClass('withDialogPosFix');}},_initSecurityPolicy:function(){U.initCSP();},isTodoPanelFullyFeatured:function(){return U.isRunningBaseDomain();},_initTodos:function(){var a=this.mModel;if(a.getProperty('/enableGlobalTodos')){var b=this._todoActionPath;var e=function(i){a.setProperty('/globalTodoCount',i);if(b){a.setProperty(b+'/visible',i>0);a.setProperty(b+'/label',i==1?v.getText('COMMON_You_Have_Todos_SINGULAR'):v.getText('COMMON_You_Have_Todos_PLURAL',[i]));}};if(this.isTodoPanelFullyFeatured()){X().done(function(i){i.create(e,function(j,Y){a.setProperty('/globalTodoErrorMessage',j);if(Y){w.error('Error getting todo count',Y);}});});}else{this.getTodoCountManually().then(e,function(i,j){w.error('Error getting todo count',i,j);});}}},_getHeaderHeight:function(){return this.getView().$().outerHeight(true);},getTodoCountManually:function(){var a=this.getSessionStorage();var b=a&&a.get('todoCount');if(b!=null){return $.Deferred().resolve(b);}d.registerODataService({serviceName:['getTodoPanelInitializer','getTodoDetails'],serviceAlias:'_ToDo_'});d.finalizeODataRegistry({serviceAlias:'_ToDo_'});return d.invokeService({type:'ODataService',serviceName:'getTodoPanelInitializer'}).then(function(e){var b=0;var j=d.normalizeODataResponse(e,'TodoPanelInitializer');$.each(j.tiles,function(i,Y){var Z=Y.properties||JSON.parse(Y.propertiesJSON);var _=Z&&Z.numberValue;if(_){if(typeof _==='number'){b+=_;}else if(_.bindModel){var a1=sap.ui.getCore().getModel(_.model);if(a1){var b1=a1.getProperty(_.path);if(typeof b1==='number'){b+=b1;}}}}else{b+=1;}});a&&a.put('todoCount',b);return b;});},getSessionStorage:function(){var a;var b=U.getSessionRef();if(b){a=$.sap.storage("session","_bizxheader_"+b);}return a;},_initShowCookiePolicy:function(){C.init();},showTodoPanel:function(){if(this.isTodoPanelFullyFeatured()){X().done($.proxy(function(a){a.togglePanel();this.toggleTodoButtonAriaExpanded(a.getPanel());},this)).fail(function(){sap.ui.require(['sap/m/MessageBox'],function(a){a.error(v.getText('COMMON_AJAX_DEFAULT_ERROR'));});});}else{if(!this._todoPanelPromise){this._todoPanelPromise=this._createCrossOriginSidePanel({panel_title:v.getText('COMMON_You_Have_Todos'),button_selector:'globalTodos',panel_type:N.todos});}BizXHeaderController._panel=null;this._todoPanelPromise.then(function(a){a.show();BizXHeaderController._panel=a;});this.toggleTodoButtonAriaExpanded(this._todoPanelPromise);}},toggleTodoButtonAriaExpanded:function(a){var b=u.byId('globalTodos');if(a&&b){var e=b.$();if(a instanceof Promise){a.then(this.ariaUnexpandedAfterHide);}else{this.ariaUnexpandedAfterHide(a,e);}e.attr('aria-expanded',true);}},ariaUnexpandedAfterHide:function(a,_){var b=_||u.byId('globalTodos').$();a.attachEvent('afterHide',function(){b.attr('aria-expanded',false);});},getJamBaseUrl:function(){return h.getBaseUrl();},getUrlOfSubTabWithId:function(a){var b=u.getModel('pageHeader');var e=b.getProperty('/subTabs');for(var i=0;i<e.length;i++){var j=e[i];if(j.id==a){return j.url;}}return null;},setUrlOfSubTabWithId:function(a,b){var e=u.getModel('pageHeader');var j=e.getProperty('/subTabs');var Y=j.length;if(Y>0){for(var i=0;i<j.length;i++){var Z=j[i];if(Z.id==a){Z=$.extend({},Z);Z.url=b;e.setProperty('/subTabs/'+i,Z);}}}},clearAddedSubTabs:function(){var a=this.mModel;var b=this.isSubTabsVisible();var i=a.getProperty('/initialTabLength');var e=a.getProperty('/subTabs');for(var j=e.length-1;j>=i;--j){e.pop();}a.setProperty('/subTabs',e);if(b&&!this.isSubTabsVisible()){$('body').addClass('globalNavigationSansSubNav');}},clearSubTabs:function(){var a=this.mModel;var b=a.getProperty('/subTabs');for(var i=b.length-1;i>=0;--i){b.pop();}a.setProperty('/subTabs',b);a.setProperty('/initialTabLength',0);$('body').addClass('globalNavigationSansSubNav');},addSubTabs:function(a){if(!$.isArray(a)){if(a){a=[a];}else{a=[];}}var b=this.isSubTabsVisible();var e=this.mModel;var j=e.getProperty('/subTabs');var Y=j.length;var Z=a.length;var _=false;for(var i=0;i<Z;i++){var a1=a[i];a1.alwaysShow=true;_=_||a1.isSelected;j.push(a1);this.registerSubTab(a1);}if(_){for(var i=0;i<Y;i++){j[i].isSelected=false;}}e.setProperty('/subTabs/',j);if(!b&&this.isSubTabsVisible()){$('body').removeClass('globalNavigationSansSubNav');}},registerSubTab:function(a){var b=a.id;if(b){var e='bizxSubTab_'+b;if(window.SFGuidedTourRegistry){SFGuidedTourRegistry.registerTopNavLink(b,e,a.isSelected);}if(window.ONBHighlighter){ONBHighlighter.registerTopNavLink(b,e);}}},getSubTab:function(i){return this.mModel.getProperty('/subTabs/'+i);},setSelectedSubTab:function(a){var b=this.mModel;var e=(b&&b.getProperty('/subTabs'))||[];e.forEach(function(j,i){j.isSelected=(i===a);});b.setProperty('/subTabs/',null);b.setProperty('/subTabs/',e);},getSubTabIndex:function(a){if(this.mModel){var b=this.mModel.getProperty('/subTabs');if(b!=null){for(var i=0;i<b.length;i++){var e=b[i];if(e&&e.id==a){return i;}}}}return-1;},updateSubTab:function(a,b){var i=this.getSubTabIndex(a);var e=i>=0;if(e){this.updateSubTabAt(i,b);}return e;},updateSubTabAt:function(i,a){if(typeof a=='string'){a={label:a,title:a};}if(this.mModel){var b='/subTabs/'+i;var e=$.extend(this.mModel.getProperty(b),a);this.mModel.setProperty(b,e);}},getModel:function(){return this.mModel;},focusHeader:function(){sap.ushell.renderers.fiori2.AccessKeysHandler.handleFocusBackToMe({shiftKey:true,keyCode:9,preventDefault:function(){}});},focusContent:function(){var a=sap.ushell.renderers.fiori2.AccessKeysHandler;var e=a.fnExternalKeysHandler;if(e&&$.isFunction(e)){e.call(a,{shiftKey:false,keyCode:9,preventDefault:function(){}},a.bFocusPassedToExternalHandlerFirstTime);a.bFocusPassedToExternalHandlerFirstTime=false;}},isSubTabsVisible:function(){var a=this.mModel;return a.getProperty('/subTabs/length')>1||!!a.getProperty('/subTabs/0/alwaysShow');},_$:function(){return $('#'+this.getView().getId());},_initializeChatbotSupport:function(){$.sap.require('sap.sf.digitalexperience.CopilotServicesUtil');$.sap.registerModulePath("sap.cp.ui","/copilot/ui");try{$.sap.require('sap.cp.ui.copilot-bootstrap');A.registerQuickcardHandler({actionName:'CopilotQuickcardHandler',actionHandler:function(a){jQuery.sap.require('sap.cp.ui.services.DigitalAssistant');sap.cp.ui.services.DigitalAssistant.askCoPilot(a.actionLabel);}});}catch(e){}},showVersionInfo:function(a){if(this._aboutBoxMarkup==null){this._aboutBoxMarkup=this.mModel.getProperty('/aboutBoxMarkup')||$('#aboutBox').html();}var b={content:this._aboutBoxMarkup,refocusRef:a||this._getUtilityLinksMenuButton()};sap.ui.require(['sap/sf/surj/shell/util/AboutBoxUtil'],function(e){e.open(b);});return false;},proxyNow:function(){if(U.isRunningBaseDomain()){P.showDialog();}else{}},onBeforeLogout:function(){if(window.SFSessionStorage){SFSessionStorage.clear();}if(window.SFSessionTimeout){SFSessionTimeout.disableUIDisplay();SFSessionTimeout.endSession();}if(!window.TopNavLogout){jQuery.sap.require('sap.sf.surj.shell.util.TopNavLogout');}},hideUtilityLinksPopover:function(){var a=u.byId('utilityLinksMenuId-menuPopover');if(a){setTimeout(function(){a.close();},100);}},_getUtilityLinksMenuButton:function(){return jQuery('#utilityLinksMenuId');},_initDowntime:function(a){if(a){var b='_downtimeDisplayed_'+a.fromDate+"_"+a.toDate;var e=this.getSessionStorage();if(e&&!e.get(b)){e.put(b,a);sap.ui.require(['sap/sf/surj/shell/util/DowntimeNotificationUtil'],function(i){i.show(a);});}}},_initSessionTimeout:function(){var b=window.useSessionTimeout;if(!U.isRunningBaseDomain()&&U.isBaseDomainCORSEnabled()&&this.mModel.getProperty('/settings/sessionTimeoutConfigs')){b=true;}if(b){sap.ui.require(['sap/sf/surj/shell/session/SessionTimer'],function(a){a.start();});}},_handleSapShellParam:function(){var a=U.findURLParam("sap-shell")||"";var b=a.toUpperCase()==="FLP";var e=this.getSessionStorage();if(e&&!b){if(a==="false"){e.remove("allowEmbeddableMode");}b=e.get("allowEmbeddableMode");}if(b){e&&e.put("allowEmbeddableMode",true);this.mModel.setProperty('/allowEmbeddableMode',true);$('body').addClass('bizXEmbeddedMode');}},_handleSidePanelParam:function(){var a=U.findURLParam(O)||"";switch(a){case N.todos:this.showTodoPanel();return;case N.notifications:this.toggleGlobalNotificationPanel();return;default:return;}},_isFiori3HeaderEnabled:function(){var a=this.mModel||u.getModel('pageHeader');var i=a.getProperty('/headerVersion');return i>=V;},_initFooter:function(){var a=this.mModel.getProperty('/footer');if(a){var b=$('#footer');if(b.length==0){b=$(a);var e=$('.globalPlacemat');if(e.length>0){b.insertAfter(e);}}}else{$('body').addClass('hideGlobalFooter');}}});var W;function X(){if(!W){W=$.Deferred();var a=$.sap.getObject(T);if(a){W.resolve(a);}else{sap.ui.require(['sap/sf/todo/util/PanelManager'],function(b){W.resolve(b);},function(e){var b='Could not load TodoPanel.';jQuery.sap.log.error(b,e);W.reject(b);});}}return W;}});
