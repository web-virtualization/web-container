sap.ui.define('sap/sf/surj/shell/util/SearchUtil',['jquery.sap.global','sap/sf/surj/shell/util/DeferredUtil','sap/sf/surj/shell/util/LinkUtil','sap/sf/surj/shell/util/Logger','sap/sf/surj/shell/util/Config','sap/sf/surj/shell/util/Util','sap/ui/base/EventProvider'],function($,D,L,a,C,U,E){var R={jsup:{search:function(c){c=$.extend({m:'autocomplete',findtype:'fullname',maxresults:30,hideusername:false,includeInactive:false,includeExternalUsers:false,includeExternalUsersNonMtr:false,adminPage:false,groupId:0},c);var x=$.ajax({dataType:'json',url:'/jsup?'+$.param(c)});return $.extend(x.then(function(r){var i=S.maybeUnescapePlainText(r&&r.ResultSet&&r.ResultSet.Result,true);var t=(i&&i[0]&&i[0].Count)||0;return{totalCount:t,hasMore:i.length<t,items:i,more:null};}),{abort:$.proxy(x.abort,x)});}}};var S={maybeUnescapePlainText:function(v,c){return U.maybeUnescapePlainText(v,c);},isAllowOneCharQuery:function(){var i=['ja','ko','zh'];return i.indexOf(sap.ui.getCore().getConfiguration().getLocale().getLanguage())>=0;},createThrottle:function(c){c=new C(c,{throttleTime:300,searcher:$.proxy(S.search,S)});var s=c.searcher;if($.isArray(s)&&typeof s[0]=='function'){s=$.proxy(s[0],s[1]);}var t=c.throttleTime;var o=new sap.ui.base.EventProvider();var b,n,l=0;$.extend(o,{change:function(T,d){b&&b();b=n=null;var r=s;var f=Array.prototype.slice.call(arguments);var A=false;var i=++l;var g=null;var h=null;var I=0;if(typeof T=='function'){r=T;f=[];}else if(f.length==1||typeof T=='object'){d=T;T=null;}function j(e){return function(){if(!A&&i==l){return e.apply(this,arguments);}}}function k(p){var F=!g;o.fireEvent('pending',{pending:true});p=p||r.apply(null,f);g=p.always(function(){if(F){o.fireEvent('reset');}o.fireEvent('pending',{pending:false});}).done(j(function(m){var M=m.hasMore&&typeof m.more=='function';if(M){n=j(function(){n=null;o.fireEvent('pending',{pending:true});k(m.more());});}var q=m.items;var u=I;if($.isArray(q)){I+=q.length;}try{o.fireEvent('pageReady',{first:F,itemOffset:u,type:m.type,criteria:d,totalCount:m.totalCount,hasMore:m.hasMore,items:q,moreAvailable:M,response:m});}catch(e){a.error(e);}})).fail(j(function(){o.fireEvent('error',{response:arguments});}));}b=j(function(){A=true;h!=null&&clearTimeout(h);if(g&&g.state()=='pending'){if(typeof g.abort=='function'){g.abort();}o.fireEvent('pending',{pending:false});}h=g=null;});h!=null&&clearTimeout(h);h=setTimeout(j(function(){h=null;k();}),t);},hasMore:function(){return!!n;},more:function(){n&&n();},abort:function(){b&&b();}});$.each(['pageReady','pending','error','reset'],function(i,e){var d=null;var h=c[e];if($.isArray(h)&&typeof h[0]=='function'){h=$.proxy(h[0],h[1]);}if(typeof h=='function'){o.attachEvent(e,h);}});return o;},search:function(t,c){var s=R[t];if(s&&typeof s.search=='function'){return s.search(c);}else{return $.Deferred().reject('Invalid search type: '+t).promise();}},externalSearch:function(t,c){var s=R[t];if(s&&typeof s.getExternalSearchUrl=='function'){L.handle({url:s.getExternalSearchUrl(c)});}else{throw new Error('Missing getExternalSearchUrl for search adapter for type '+t);}},selectItem:function(t,i){var s=R[t];if(s&&typeof s.selectItem=='function'){return s.selectItem(i);}else{throw new Error('[SearchUtil] Invalid search type');}},register:function(t,s){R[t]=s;},getHighlightedMarkup:function(t,s,m,M,i){function e(t){return i?t:$.sap.encodeHTML(t);}if(s){var r=new RegExp(s,"i");var b=t.match(r);if(b){var p=t.substring(0,b.index);var c=t.substr(b.index,s.length);var d=t.substr(b.index+s.length);return e(p)+m+e(c)+M+e(d);}else{return e(t,i);}}else{return e(t,i);}}};$.sap.setObject('sap.sf.surj.shell.util.SearchUtil',S);return S;});
