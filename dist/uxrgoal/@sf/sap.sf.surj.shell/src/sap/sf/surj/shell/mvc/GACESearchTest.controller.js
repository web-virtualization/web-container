(function($){function p(j){return JSON.stringify(j,null,4);}function a(s){try{return JSON.parse(s);}catch(e){return null;}}sap.ui.controller('sap.sf.surj.shell.mvc.GACESearchTest',{onInit:function(){$.sap.require('sap.ui.core.format.DateFormat');var I=sap.ui.core.format.DateFormat.getDateInstance({pattern:'yyyy-MM-dd'});var m=this.oModel=new sap.ui.model.json.JSONModel({smartSuiteMode:true,useQuickcardSearch:false,ajaxServiceHasError:false,odataServiceHasError:false,ajaxServiceSuggestions:[{key:"quickcardController.searchPersonAdvanced",value:{serviceName:'quickcardController',serviceMethod:'searchPersonAdvanced',arguments:[{"searchParameters":[{"key":"FIRST_NAME","ids":null,"values":["carla","admin","vlad4"]},{"key":"LAST_NAME","ids":null,"values":["carla","grant","user"]}],"resultScope":"Person","includeInactiveUsers":"YES","includeInactivePersons":"YES","includeExternalPersons":"YES","includeHomeEmpl":"YES","includeSecondEmpl":"YES","matchType":"S","page":1}]}},{key:"quickcardController.getRenderingInfoPersonAdvancedSearch",value:{serviceName:'quickcardController',serviceMethod:'getRenderingInfoPersonAdvancedSearch',arguments:[["FIRST_NAME","LAST_NAME","USER_NAME","DEPARTMENT","LOCATION","USER_ROLE","RBP_ROLES"]]}},{key:"foundationAutoCompleteController.search",value:{serviceName:"foundationAutoCompleteController",serviceMethod:"search",arguments:[{"baseElement":"jobInfo","searchType":"location","hrisElementField":"jobinfo-location","applyTC":"FALSE","target":"FoundationObject","contextualSearchFields":{"jobInfo-company":"7","start-date":"2017-02-09"}}]}},{key:"customFieldAsGOAutoCompleteController.search",value:{serviceName:"customFieldAsGOAutoCompleteController",serviceMethod:"search",arguments:[{"baseElement":"jobInfo","searchType":"Department","hrisElementField":"jobInfo-department","applyTC":"FALSE","target":"GenericObject","contextualSearchFields":{"jobInfo-division":"4","start-date":"2017-02-09"}}]}}],odataServiceSuggestions:[{key:"oDataV2",label:"oData V2",value:{serviceName:'personSimpleSearch',baseUrl:'/odata/v2/restricted/',urlParams:{"$format":"'json'",searchValue:"'cgrant'",page:1,startIndex:0,includeInactiveEmpl:false,includeInactivePersons:true,resultScope:"Employment",employmentEffectiveFrom:"'2020-02-19'",employmentEffectiveTo:"'2020-02-19'",includeSecondEmpl:true,includeECMasteredUsersOnly:false,enforceIgnoreProvisioningFlags:true,includeContingentWorkers:true,displayContingentWorkersInformation:true,includeExternalUsers:false,includeExternalPersonType:"''",includeHomeAssignment:true,includeLocationInfoPerEmpl:false,dynamicGroupId:"''",useAlternativePermissionType:"''"}}},{key:"oDataV4",label:"oData V4",value:{serviceName:'personSimpleSearch()',baseUrl:'/odata/v4/PersonSearch.svc/',urlParams:{"$format":"json",searchValue:"cgrant",page:1,startIndex:0,includeInactiveEmpl:false,includeInactivePersons:true,resultScope:"Employment",employmentEffectiveFrom:"2020-02-19",employmentEffectiveTo:"2020-02-19",includeSecondEmpl:true,includeECMasteredUsersOnly:false,enforceIgnoreProvisioningFlags:true,includeContingentWorkers:true,displayContingentWorkersInformation:true,includeExternalUsers:false,includeExternalPersonType:"",includeHomeAssignment:true,includeLocationInfoPerEmpl:false,dynamicGroupId:"",useAlternativePermissionType:""}}}],settings:{oDataServiceKey:"oDataV2",additionalCriteria:{includeInactiveEmpl:"NO",includeInactivePersons:"YES",includeExternalPersons:"NO",includeExternalPersonType:"",resultScope:"Employment",employmentEffectiveFrom:I.format(new Date()),employmentEffectiveTo:I.format(new Date()),includeHomeEmpl:"YES",includeSecondEmpl:"YES",displayLocation:"YES",includeECMasteredUsersOnly:"NO",enforceIgnoreProvisioningFlags:"YES",dynamicGroupId:"",useAlternativePermissionType:"",includeContingentWorkers:"YES",displayContingentWorkersInformation:"YES"},legacySearchCriteria:{findtype:'fullname',maxresults:10,hideusername:false,includeInactive:false,includeExternalUsers:false,includeExternalUsersNonMtr:false,adminPage:false,groupId:0},fieldIds:["FIRST_NAME","MIDDLE_NAME","LAST_NAME","PERSON_ID_EXTERNAL","USER_NAME","DEPARTMENT","LOCATION","DIVISION","USER_ROLE","RBP_ROLES","JOB_CODE","NATIONAL_ID","PREFERRED_NAME","FORMAL_NAME","EMAIL","HIRE_DATE"]}});var s=m.getProperty('/ajaxServiceSuggestions');$.each(s,function(i){m.setProperty('/ajaxServiceSuggestions/'+i+'/value/arguments-text',p(this.value.arguments));});m.setProperty('/ajaxService',$.extend({},s[0].value));s=m.getProperty('/odataServiceSuggestions');$.each(s,function(i){m.setProperty('/odataServiceSuggestions/'+i+'/value/urlParams-text',p(this.value.urlParams));});this.selectODataService();m.setProperty('/additionalCriteria',p(m.getProperty('/settings/additionalCriteria')));m.setProperty('/legacySearchCriteria',p(m.getProperty('/settings/legacySearchCriteria')));m.setProperty('/fieldIds',p(m.getProperty('/settings/fieldIds')));this.getView().setModel(m);this.updateSmartSuiteMode();},selectODataService:function(){var m=this.oModel;var s=m.getProperty('/odataServiceSuggestions');var d=m.getProperty('/settings/oDataServiceKey');var D=s.find(function(i){return i.key===d;});m.setProperty('/odataService',$.extend({},D.value));},onDataServiceSelectionChange:function(e){this.oModel.setProperty('/settings/oDataServiceKey',e.getSource().getSelectedKey());this.selectODataService();},changeAjaxSuggest:function(e){var v=e.getParameter('selectedItem').getBindingContext().getObject().value;var m=this.getView().getModel();m.setProperty('/ajaxService',$.extend({},v));},changeOdataSuggest:function(e){var v=e.getParameter('selectedItem').getBindingContext().getObject().value;var m=this.getView().getModel();m.setProperty('/odataService',$.extend({},v));},updateUseQuickcardSearch:function(){var m=this.getView().getModel();var u=m.getProperty('/useQuickcardSearch');var s=m.getProperty('/settings');s.legacySearchType=u?'People':null;m.setProperty('/settings',s);},invokeAjaxService:function(){try{var t=this;var m=this.getView().getModel();sap.sf.surj.shell.util.DeferredUtil.invokeService({type:'ajaxService',serviceName:m.getProperty('/ajaxService/serviceName'),serviceMethod:m.getProperty('/ajaxService/serviceMethod'),arguments:m.getProperty('/ajaxService/arguments')}).done(function(r){t.serviceLog('/service-log','Response: ',r);}).fail(function(M,E){t.serviceLog('/service-log','Ajax Error: ',M);});}catch(e){surj.Logger.error(e);this.serviceLog('/service-log','Exception: ',e.message);}},invokeOdataService:function(){try{var t=this;var m=this.getView().getModel();sap.sf.surj.shell.util.DeferredUtil.invokeService({type:'ODataService',serviceName:m.getProperty('/odataService/serviceName'),baseUrl:m.getProperty('/odataService/baseUrl'),urlParams:m.getProperty('/odataService/urlParams')}).done(function(r){t.serviceLog('/odataservice-log','Response: ',r);}).fail(function(M,E){t.serviceLog('/odataservice-log','Ajax Error: ',M);});}catch(e){surj.Logger.error(e);this.serviceLog('/odataservice-log','Exception: ',e.message);}},readUrlParams:function(){var m=this.getView().getModel();var u=a(m.getProperty('/odataService/urlParams-text'));if(u){m.setProperty('/odataServiceHasError',false);m.setProperty('/odataService/urlParams',u);}else{m.setProperty('/odataServiceErrorMessage','Invalid JSON Format');m.setProperty('/odataServiceHasError',true);}},readCriteriaText:function(){var m=this.getView().getModel();var A=a(m.getProperty('/additionalCriteria'));var l=a(m.getProperty('/legacySearchCriteria'));var f=a(m.getProperty('/fieldIds'));var s=m.getProperty('/settings');if(A){s.additionalCriteria=A;}if(l){s.legacySearchCriteria=l;}if(f){s.fieldIds=f;}m.setProperty('/settings',s);},updateSmartSuiteMode:function(){var m=this.getView().getModel();var g=jQuery('#autocomplete\\.personBased');if(!g.length){g=jQuery('<meta id="autocomplete.personBased" content="">').appendTo('head');}g.attr('content',m.getProperty('/smartSuiteMode')?'true':'false');},updateArguments:function(){var m=this.getView().getModel();var A=a(m.getProperty('/ajaxService/arguments-text'));if(A){m.setProperty('/ajaxService/arguments',A);m.setProperty('/ajaxServiceHasError',false);}else{m.setProperty('/ajaxServiceErrorMessage','Invalid JSON Format');m.setProperty('/ajaxServiceHasError',true);}},itemSelected:function(e){this.serviceLog('/event-log','itemSelected: ',e.getParameter('selectedItem'));},serviceLog:function(P,s,m){var M=this.getView().getModel();var v=M.getProperty(P)||'';if(v){v+='\n';}v+=s+p(m);M.setProperty(P,v);},advancedSearch:function(e){var m=this.getView().getModel();var A=a(m.getProperty('/additionalCriteria'));var f=a(m.getProperty('/fieldIds'));$.sap.require('sap.sf.surj.shell.util.GACEAdvancedSearchUtil');sap.sf.surj.shell.util.GACEAdvancedSearchUtil.show({oDataServiceKey:m.getProperty('/settings/oDataServiceKey'),source:e.getSource(),additionalCriteria:A,fieldIds:f});}})})(jQuery);
