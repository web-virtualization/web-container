sap.ui.define('sap/sf/surj/shell/BizXHeader.view',['jquery.sap.global','sap/ui/core/CustomData','sap/ui/core/delegate/ItemNavigation','./controls/Container','./controls/NotificationWrapper','./controls/FocusMarker','./controls/BizXButton','./controls/BizXSearchField','./controls/UserPhoto','./util/SuppIconPool','./util/A11yPreferences','./util/Util','sap/m/SearchField','sap/m/SuggestionItem','sap/m/Bar','sap/m/Text','sap/m/Image','sap/m/OverflowToolbar','sap/m/Link','sap/ui/core/theming/Parameters'],function($,C,I,a,N,F,B,b,U,S,A,c,d,e,f,T,g,O,L,P){"use strict";var o=sap.ui.getCore();var r=o.getLibraryResourceBundle('sap.sf.surj.shell.i18n');var h=3;sap.ui.jsview('sap.sf.surj.shell.BizXHeader',{createContent:function(i){this.addStyleClass('sfRevolutionTopNavigationMobile globalHeaderContainerWidthBackground globalNavigationContainer globalHeaderHeight surjTopNav globalHeader');if(A.isLowVisionEnabled()){this.addStyleClass('globalLowVisionSupport');this.addStyleClass(A.getLowVisionType());}var j=[this.createCustomHeader(i),this.createSubHeader(i)];if($.sap.getObject('sap.ushell.renderers.fiori2.AccessKeysHandler')){var k=new F();var l=new F();k.addEventDelegate({onfocusin:function(){i.focusContent();}});l.addEventDelegate({onfocusin:function(){i.focusHeader();}});j.push(k,l);}return j;},createCustomHeader:function(i){var t=this;var m=o.getModel('pageHeader');var H=m.getProperty('/headerVersion');var j=H>=h;var k=new d({enableSuggestions:true,suggestionItems:[new e({text:'test'}),new e({text:'test'}),new e({text:'test'})],suggest:function(){k.suggest(true);}});var s=new b('bizXSearchField',{resetOnBlur:true,showRefreshButton:true,showSearchButton:false,visible:{parts:[{path:'universalSearch>/searchEnabled'}],formatter:function(y){return y&&!u;}},a11yLabel:'{universalSearch>/a11yLabel}',a11yAnnouncement:'{universalSearch>/a11yAnnouncement}',value:'{universalSearch>/filter}',transitiveText:'{universalSearch>/transitiveAction/actionLabel}',showSearchType:'{universalSearch>/searchTypeVisible}',searchTypeTooltip:r.getText('COMMON_Global_Action_Search_Selector_Aria_Label'),searchTypeAriaLabel:r.getText('COMMON_SEARCH_SELECTOR_A11Y'),tooltip:'{universalSearch>/tooltip}',placeholder:'{universalSearch>/placeholder}',enableSuggestions:'{universalSearch>/enableSuggestions}',pending:'{universalSearch>/pending}',pressSearchType:[i.showSearchType,i],search:[i.search,i],suggest:[i.searchSuggest,i],reset:[i.reset,i],scrollDelegateAvailable:[i.setSearchScrollDelegate,i],suggestionItemSelected:[i.selectSuggestItem,i],enableExternalSearch:'{universalSearch>/enableExternalSearch}',externalSearch:[i.externalSearch,i],quickcardRequest:[i.quickcardRequest,i],focusQuickcard:[i.focusQuickcard,i],highlightExternalSearch:[i.highlightExternalSearch,i],afterSuggestClose:[i.afterSuggestClose,i],customData:new C({key:"help-id",value:'bizxHeaderSearchField',writeToDom:true})});var u=s.isUseDialog();var l=new B('bizXSuggestButton',{icon:'sap-icon://search',tooltip:'{universalSearch>/placeholder}',press:[i.openSearchSuggestion,i],visible:{parts:[{path:'universalSearch>/searchEnabled'}],formatter:function(y){return y&&u;}},customData:new C({key:"help-id",value:'bizxHeaderSuggestButton',writeToDom:true})});if(u){s.isActive=function(){return l.isActive();}}var M;var n=new f('bizXShellCustomHeader',{design:'Header',contentLeft:[new B('bizXShellHomeIcon',{visible:{parts:['pageHeader>/enableHomeIcon','pageHeader>/homeModule'],formatter:function(y,z){return z&&(y&&!j);}},icon:'sap-icon://home',press:[i.navigateToHome,i],tooltip:r.getText('COMMON_Go_To_Home_Page'),ariaLabel:r.getText('COMMON_Home'),customData:new C({key:"help-id",value:'bizxHeaderHomeIcon',writeToDom:true})}).addStyleClass('surjTopNavHomeButton bizXDisableMobile'),M=new B("customHeaderModulePickerBtn",{visible:{path:'pageHeader>/modules',formatter:function(y){return y.length>0;}},ariaLabel:r.getText('COMMON_MENU_MAIN_NAVIGATION'),icon:j?'sap-icon://megamenu':'sap-icon://slim-arrow-down',text:{parts:[{path:'pageHeader>/title'}],formatter:function(y){return t.unescapeHTML(y);}},press:[i.showModulePicker,i],iconFirst:false,tooltip:{parts:['pageHeader>/title','pageHeader>/selectedModule','pageHeader>/modules'],formatter:function(y,z,D){var E=0;for(E=D.length-1;E>=0;E--){if(D[E].isSelected)break;}var G=(z?z.title:y);return r.getText('COMMON_MENU_CURRENT_MODULE_MAIN_NAVIGATION',[G,++E,D.length]);}},customData:new C({key:"help-id",value:'bizxHeaderModulePicker',writeToDom:true})}).addStyleClass('bizXShellDropMenuButton bizXDisableMobile').addEventDelegate({onAfterRendering:function(){var y=$("#customHeaderModulePickerBtn");y.attr({"aria-haspopup":true,"aria-expanded":false,"aria-controls":(y.attr("id")+"-menuPopover")});}}),new B({visible:{path:'pageHeader>/modules',formatter:function(y){return y.length>0;}},icon:j?'sap-icon://megamenu':'sap-icon://menu2',press:[i.showModulePicker,i]}).addStyleClass('bizXMobileOnly'),new T({text:{parts:[{path:'pageHeader>/title'}],formatter:function(y){return t.unescapeHTML(y);}},visible:!j}).addStyleClass('surjTopNavTitle globalHeaderText bizXMobileOnly')],contentRight:[l,s,this.createGlobalNotificationButton(i),this.createTodoButton(i),this.createJobPickerButton(i),this.createUserMenuButton(i),this.createProductSwitcherButton(i)]}).addStyleClass('globalHeaderBar surjTopNavHeaderBar');var p=m.getProperty('/settings');var q;if(p&&(p.hideGlobalNavigationMenuEnabled!=null)){q=(String(p.hideGlobalNavigationMenuEnabled)=='true');}else{q=($('#hideGlobalNavigationMenuEnabled').attr('content')=='true');}if(q){M.addStyleClass('hiddenGlobalNavigationMenu');}n.addEventDelegate({onAfterRendering:function(){n.$().attr('role','banner');var y=$('.sapMBarRight',n.$());if(y&&y.css('width')){y.css('width','');}if(jQuery('#'+s.getId()+'>form').length==0){setTimeout(function(){s.rerender();},500);}}});var v=new g({densityAware:false,src:"{pageHeader>/logoInfo/url}",decorative:true,}).addStyleClass('globalLogoPrimaryImage sapMBtnHoverable sapMFocusable');var w=new a().addStyleClass('globalLogoUploadedImageRevealer');w.addEventDelegate({onAfterRendering:function(){c.waitForGlobalTheme().then(function(){var w=jQuery(".globalLogoUploadedImageRevealer");if(w.length>0&&w.css("left")=="1px"){var y=w.css("background-image");if(y!="none"){v.setSrc((y.match(/url\("?([^"]*)"?\)/)||[])[1]);}}});}});var x=new a('bizXHeaderCompanyLogo',{customData:new C({key:"help-id",value:'bizxHeaderCompanyLogo',writeToDom:true}),content:[v,w]}).addStyleClass('bizXDesktopOnly globalLogo company-logo');x.addEventDelegate({onAfterRendering:function(){x.$().attr({'role':'button','tabindex':0,'title':r.getText('COMMON_LOGO_ALT',m.getProperty('/logoInfo/altText'))});}});x.onclick=i.navigateToHome.bind(i);x.onkeydown=function(y){if(y.keyCode===$.sap.KeyCodes.ENTER||y.keyCode===$.sap.KeyCodes.SPACE){i.navigateToHome();}};i.insertCompanyLogo(n,x);this.oHeaderBar=n;return n;},createSubHeader:function(j){var t=this;sap.m._overflowToolbarHelpers.OverflowToolbarAssociativePopoverControls._mSupportedControls['sap.m.Link']={canOverflow:true,listenForEvents:["press"],noInvalidationProps:["enabled","type"]};var s=new sap.ui.core.InvisibleText({text:r.getText('COMMON_Selected')}).toStatic();var k=true;var l=new O('surjSubTabBar',{visible:{parts:[{path:'pageHeader>/subTabs/length'},{path:'pageHeader>/subTabs/0/alwaysShow'}],formatter:function(i,m){return i>1||!!m;}},ariaLabelledBy:new sap.ui.core.InvisibleText({text:r.getText('COMMON_Subnavigation')}).toStatic(),content:{path:'pageHeader>/subTabs',factory:function(i,m){var n=m.getObject();var p=new L(n.id?"bizxSubTab_"+n.id:i,{text:'{pageHeader>label}',tooltip:{parts:[{path:'pageHeader>title'}],formatter:t.unescapeHTML.bind(t)},href:{parts:[{path:'pageHeader>url'}],formatter:t.unescapeHTML.bind(t)}}).addStyleClass(n.isSelected?'globalNavigationActiveItem':'globalNavigationItem').addStyleClass('surjSubTabItem');if(n.isSelected){p.addAriaDescribedBy(s);}p.addEventDelegate({onAfterRendering:function(){var E=p.$().removeClass('sapMLnk');var q=t.unescapeHTML(n.onclick);if(E.length>0&&q){if(typeof q=='string'){E.attr('onclick',q);}else if(typeof q=='function'){E[0].onclick=q;}}}});return p;}}}).addEventDelegate({onAfterRendering:function(){function u(){jQuery('#surjSubTabBar-overflowButton').attr('type','button');}if(k){u();var m=l.getAggregation("_overflowButton");m.addEventDelegate({onAfterRendering:function(){u();}});var n=l.getAggregation("_popover");n.addStyleClass('globalMenu');n.attachBeforeOpen(function(){var y=this.getAssociatedContent();y.forEach(function(z){o.byId(z).addStyleClass('globalMenuItem surjOverflowItem')})});n.attachBeforeClose(function(){var y=this.getAssociatedContent();y.forEach(function(z){o.byId(z).removeStyleClass('globalMenuItem surjOverflowItem')})});if(!this._subTabItemNav){this._subTabItemNav=new I().setCycling(false);l.addDelegate(this._subTabItemNav);}k=false;}if(this._subTabItemNav){var p=l.getDomRef();var q=p.children;var v=q.length;var w=0;for(var i=0,x;i<v;i++){x=q[i];x.setAttribute('aria-posinset',i+1);x.setAttribute('aria-setsize',v);x.setAttribute('role','menuitem');if(x.classList.contains('globalNavigationActiveItem')){w=i;}}this._subTabItemNav.setRootDomRef(p);this._subTabItemNav.setItemDomRefs(q);this._subTabItemNav.setSelectedIndex(w);}l.getDomRef().setAttribute('role','menubar');}}).addStyleClass('surjSubTabBar globalNavigation sub-nav-container');return l;},createJobPickerButton:function(i){var E={mouseenter:$.proxy(i.mouseEnterJobPicker,i),mouseleave:$.proxy(i.mouseLeaveJobPicker,i)};var j=new B({icon:'sap-icon://switch-classes',tooltip:{parts:[{path:'pageHeader>/selectedAssignment'}],formatter:function(s){if(s){return r.getText('COMMON_Select_Employment_Tooltip_Text',[s.label]);}return r.getText('COMMON_Select_Employment_Tooltip_Text_NoSelection');}},ariaLabelledBy:new sap.ui.core.InvisibleText({text:{parts:[{path:'pageHeader>/selectedAssignment'}],formatter:function(s){if(s){return r.getText('COMMON_Select_Employment_Tooltip_Text',[s.label]);}return r.getText('COMMON_Select_Employment_Aria_Text_NoSelection');}}}).toStatic(),visible:{parts:[{path:'pageHeader>/globalAssignmentLinks'}],formatter:function(G){return!sap.ui.Device.system.phone&&!!G&&G.length>1;}},press:[i.pressJobPicker,i],customData:new C({key:"help-id",value:'bizxHeaderJobPickerButton',writeToDom:true})}).addStyleClass('jobSelectorButton').addEventDelegate({onAfterRendering:function(){j.$().unbind(E).bind(E);}});return j;},createGlobalNotificationButton:function(i){return new N({text:{parts:[{path:'globalNotification>/newCount'},{path:'jamNotification>/newCount'}],formatter:function(j,k){var t=parseInt(j?j:0,10)+parseInt(k?k:0,10);return t>50?'50+':(t?t:'');}},visible:{parts:[{path:'globalNotification>/visible'},{path:'jamNotification>/visible'}],formatter:function(j,k){return!!(j||k);}},content:new B('current-user-notification-count',{icon:'sap-icon://bell',ariaLabel:r.getText('COMMON_Notification_title'),tooltip:{parts:[{path:'globalNotification>/newCount'},{path:'jamNotification>/newCount'}],formatter:function(j,k){var t=parseInt(j?j:0,10)+parseInt(k?k:0,10);return(t!=1)?r.getText('COMMON_Global_Notifications_new_count_plural',[t]):r.getText('COMMON_Global_Notifications_new_count_singular');}},press:[i.toggleGlobalNotificationPanel,i],customData:new C({key:"help-id",value:'bizxHeaderNotificationButton',writeToDom:true})}).addStyleClass('surjNotificationBtn').addEventDelegate({onAfterRendering:$.proxy(i._onAfterRenderingNotification,i)})});},createTodoButton:function(i){return new N({text:{parts:[{path:'pageHeader>/globalTodoCount'}],formatter:function(j){if(j===0){return'';}if(j>99){return'99+';}return j;}},visible:{path:'pageHeader>/enableGlobalTodos',formatter:function(E){return!sap.ui.Device.system.phone&&!!E;}},content:new B('globalTodos',{ariaLabel:r.getText('COMMON_You_Have_Todos'),icon:'sap-icon://sys-enter',tooltip:{parts:[{path:'pageHeader>/globalTodoCount'}],formatter:function(j){if(j===0){return r.getText('HOME_Todo_MSG_ALL_COMPLETED');}if(j>99){return r.getText('COMMON_You_Have_Todos_PLURAL',['99+'])}return j===1?r.getText('COMMON_You_Have_Todos_SINGULAR'):r.getText('COMMON_You_Have_Todos_PLURAL',[j]);}},press:[i.showTodoPanel,i],customData:new C({key:"help-id",value:'bizxHeaderTodoButton',writeToDom:true})}).addStyleClass('surjTodoButton').addEventDelegate({onAfterRendering:function(){var G=o.byId('globalTodos');if(G){G.$().attr({'aria-expanded':false,'aria-controls':'globalTodoPanel'});}}})});},createUserMenuButton:function(i){var m=o.getModel('pageHeader');var H=m.getProperty('/headerVersion');var M,j;var k=[i.showUtilityLinks,i];var s='utilityLinksMenuId';if(m&&!m.getProperty('/userInfo/photoEnabled')&&H<h){j={press:k,enabled:{parts:['pageHeader>/actionLinks/length'],formatter:function(l){return l>0;}},ariaLabel:r.getText('COMMON_MENU_ACCOUNT_NAVIGATION_ARIA_LABEL'),icon:{parts:['pageHeader>/actionLinks/length','pageHeader>/headerVersion'],formatter:function(l,H){return l>0&&H<h?'sap-icon://slim-arrow-down':null;}},text:{parts:['pageHeader>/userTopNav/fullName','pageHeader>/headerVersion'],formatter:function(l,H){return H<h?l:'';}},tooltip:{parts:['pageHeader>/userTopNav/fullName'],formatter:function(l){return r.getText('COMMON_MENU_ACCOUNT_NAVIGATION',l);}},iconFirst:false,customData:new C({key:"help-id",value:'bizxHeaderUserMenuButton',writeToDom:true})};M=new B(s,j).addStyleClass('bizXShellDropMenuButton surjUtilityLinksMenu');}else{j={click:k,ariaLabel:r.getText('COMMON_MENU_ACCOUNT_NAVIGATION_ARIA_LABEL'),tooltip:{parts:['pageHeader>/userTopNav/fullName'],formatter:function(l){return r.getText('COMMON_MENU_ACCOUNT_NAVIGATION',l);}},user:'{pageHeader>/userTopNav}',profile:{circle:true,placeholder:sap.ui.resource('sap.sf.surj.shell.img.userphoto','')+'UserPhotoPlaceholder_50x50.png'},focusable:{parts:['pageHeader>/actionLinks/length'],formatter:function(l){return l>0;}},showUserName:{parts:['pageHeader>/headerVersion'],formatter:function(H){return H<h;}},nameDirection:'EAST',showMenuIcon:{parts:['pageHeader>/actionLinks/length','pageHeader>/headerVersion'],formatter:function(l,H){return l>0&&H<h;}},useMButtonStyles:{parts:['pageHeader>/actionLinks/length'],formatter:function(l){return l>0;}},customData:new C({key:"help-id",value:'bizxHeaderUserMenuButton',writeToDom:true}),useAvatar:{parts:['pageHeader>/headerVersion','pageHeader>/userInfo/photoEnabled'],formatter:function(H,p){return H>=h&&!p;}},displaySize:{parts:['pageHeader>/headerVersion'],formatter:function(H){return H>=h?"XS":"M";}}};M=new U(s,j).addStyleClass('globalPlacematText surjUtilityLinksMenu');}var n=new N({text:{parts:[{path:'pageHeader>/enableGlobalTodos'},{path:'pageHeader>/globalTodoCount'}],formatter:function(E,l){if(sap.ui.Device.system.phone&&!!E&&l>0){return''+l;}return'';}},content:M});M.addEventDelegate({onAfterRendering:function(){M.$().attr('aria-expanded',false);i.adjustNameSize.bind(i);}});return n;},createProductSwitcherButton:function(i){var m=o.getModel('pageHeader');var j=m.getProperty('/productSwitcherEnabled')&&(c.isRunningBaseDomain()||c.isBaseDomainCORSEnabled());if(j){var s=new B('productSwitcherBtn',{icon:'sap-icon://grid',press:[i.pressProductSwitcher,i]});return s;}},addCopilotButton:function(i){var H=this.oHeaderBar;if(!H||!i)return;var m=o.getModel('pageHeader');var j=m.getProperty('/headerVersion');if(j>=h){i.setIcon(this._getCopilotImage());H.addContentMiddle(i);}else{H.insertContentRight(i,2);}},_getCopilotImage:function(){var s=P.get('_sap_f_Shell_Bar_Copilot_Design');var i;if(s&&s!='dark'){i='sap/f/shellBar/CoPilot_white.svg';}else{i='sap/f/shellBar/CoPilot_dark.svg';}return sap.ui.require.toUrl(i);},getControllerName:function(){return'sap.sf.surj.shell.BizXHeader';},unescapeHTML:function(i){if(this.getController().isLegacyEscaped()){return jQuery('<span>'+i+'</span>').text();}else{return i;}}});});
