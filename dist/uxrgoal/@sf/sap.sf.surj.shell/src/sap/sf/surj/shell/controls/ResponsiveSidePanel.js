jQuery.sap.declare("sap.sf.surj.shell.controls.ResponsiveSidePanel");jQuery.sap.require("sap.sf.surj.shell.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.sf.surj.shell.controls.ResponsiveSidePanel",{metadata:{library:"sap.sf.surj.shell"}});sap.ui.define('sap/sf/surj/shell/controls/ResponsiveSidePanel',['jquery.sap.global','sap/ui/core/Control','sap/ui/core/Popup','sap/ui/Device','sap/sf/surj/shell/util/A11yPreferences'],function($,C,P,D,A){"use strict";return C.extend('sap.sf.surj.shell.controls.ResponsiveSidePanel',{metadata:{library:'sap.sf.surj.shell',interfaces:['sap.ui.core.PopupInterface'],publicMethods:['show','hide','isShown'],events:{afterHide:{},afterShow:{}},properties:{closeOnClick:'boolean',from:'string',refocusRef:'any',widthThreshold:{type:'int',defaultValue:320},resizeHide:{type:'boolean',defaultValue:false},top:{type:'any',defaultValue:0},left:'string',modal:'boolean'},aggregations:{header:{multiple:false,type:'sap.m.IBar'},content:{multiple:true,type:'sap.ui.core.Control',singularName:'content'}},defaultAggregation:'content'},init:function(){var t=this;this.oPopup=new P(this);this.oPopup.setModal(true,'transparentShim');this.oPopup.setDurations(250,250);this.oPopup.onsapescape=$.proxy(this.hide,this);this.oPopup.attachClosed(function(){var r=t.getRefocusRef();jQuery.sap.focus(r);t.fireAfterHide();if(window.SFBodyEventDispatcher){SFBodyEventDispatcher.handleBodyReset(false,true);}});},exit:function(){if(this.oPopup){this.oPopup.destroy();this.oPopup=null;}},show:function(){if(this.hide===$.sap.getObject('sap.sf.surj.shell.controls.ResponsiveSidePanel').prototype.hide){this.hide=$.proxy(this.hide,this);}var p=this.oPopup;var f=this.getFrom();var t=parseInt(this.getTop());var r=sap.ui.getCore().getConfiguration().getRTL();if(f=='begin'){f=r?'right':'left';}if(f=='end'){f=r?'left':'right';}var o=$('#content');p.setPosition(f+' top+'+t,f+' top',document.body,'0 0');p.setAnimations($.proxy(function(a,d,c){var w=this.$('wrapper');var O=a.css('overflow');w.css({position:'absolute',width:a.width()+'px'}).css(f=='left'?'right':'left',0);a.css({width:0,display:'block'}).animate({width:this.getWidth()+'px'},d,null,function(){w.css({position:'static',width:'100%'});a.css('overflow',O);c&&c();window.scrollTo(window.scrollX,0);});},this),$.proxy(function(a,d,c){var O=a.css('overflow');this.$('wrapper').css({position:'absolute',width:a.width()+'px'});a.animate({width:0},d,null,c);},this));p.open();this.mInitWidth=$(window).width();setTimeout($.proxy(function(){$('#sap-ui-blocklayer-popup').on('mousedown touchstart',this.hide);},this),100);},hide:function(){if(this.isShown()){$('#sap-ui-blocklayer-popup').off('mousedown touchstart',this.hide);if(window.SFBodyEventDispatcher){SFBodyEventDispatcher.removeResizeListener(null,this);}else{jQuery(window).off('resize',this._resizeHandler);}this.oPopup.close();}},isShown:function(){return this.oPopup.isOpen();},renderer:function(r,c){r.write('<div');r.writeControlData(c);r.addClass('globalPortletBodyBackground');r.addClass('surjResponsiveSidePanel');if(A.isLowVisionEnabled()){r.addClass('globalLowVisionSupport');r.addClass(A.getLowVisionType());}r.writeClasses();r.write(' style="width:',c.getWidth(),'px;height:',c._getHeight(),'px;overflow:hidden">');r.write('<div id="',c.getId(),'-wrapper" style="width:100%;height:100%;">');var h=c.getHeader();h&&r.renderControl(h);var a=c.getContent();r.write('<div id="',c.getId(),'-content" style="width:100%;height:',c._getContentHeight(),'px">');$.each(a,function(n,o){r.renderControl(o);});r.write('</div></div></div>');},getWidth:function(){var w=$(window).width();var t=this.getWidthThreshold();if(D.system.phone||w<t){return w;}else{return t;}},onAfterRendering:function(){if(window.SFBodyEventDispatcher){SFBodyEventDispatcher.addResizeListener(this,'_onWindowResize');}else{this._resizeHandler=this._resizeHandler||$.proxy(this._onWindowResize,this);$(window).on('resize',this._resizeHandler);}this.fireAfterShow();},_onWindowResize:function(){var w=$(window).width();if(this.getResizeHide()&&(Math.abs(this.mInitWidth-w)>30)){this.hide();}else{this.$().css({height:this._getHeight()+'px',width:this.getWidth()+'px'});this.$('content').css('height',this._getContentHeight()+'px');}},_getHeight:function(){return $(window).height()-parseInt(this.getTop());},_getContentHeight:function(){return this._getHeight()-(this.getHeader()?48:0);}});});
