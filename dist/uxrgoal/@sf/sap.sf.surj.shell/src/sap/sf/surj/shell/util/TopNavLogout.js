sap.ui.define('sap/sf/surj/shell/util/TopNavLogout',['jquery.sap.global'],function($){var g=null;T.INFRAME_LOGOUT_WAIT_TIME=1000;T.INFRAME_LOGOUT_USES_IFRAME=false;T.gotoURL=function(u){if(T._inframeLogoutAttempted){function c(){if(b){b.close();}PostMessageAPI.sendMessage("logoutComplete");};var a=T.INFRAME_LOGOUT_USES_IFRAME;var w=T.INFRAME_LOGOUT_WAIT_TIME;var b,i;if(!a){b=window.open(u,'bizxLogoutPopup','resizable=1,scrollbars=1,status=1,height=200,width=400');a=!b;}if(a){i=document.createElement('iframe');var s=i.style;s.position='absolute';s.visibility='hidden';s.left=0;s.top=0;s.width=0;s.height=0;document.body.appendChild(i);setTimeout(function(){i.src=u;setTimeout(c,w);},0);}else{setTimeout(c,w);}}else{if(window.Util&&Util.gotoURL){Util.gotoURL(u);}else{window.location.href=u;}}};if(window.PostMessageAPI&&PostMessageAPI.addMessageListener){PostMessageAPI.addMessageListener("logout",function(e){T._inframeLogoutAttempted=window.top!==window.self;T.startLogout();});}T.startLogout=function(){var w=window;var l;if(w.sap&&sap.ui&&sap.ui.getCore){var p=sap.ui.getCore().getModel('pageHeader');l=p&&p.getProperty('/actionLinks');}if(l==null&&w.pageHeaderJsonData&&pageHeaderJsonData.utilityLinks){l=pageHeaderJsonData.utilityLinks.links;}for(var i=0;i<l.length;i++){if(l[i].id=='LOGOUT'){var d=document;var o=l[i].onclick;var a=d.createElement('div');a.innerHTML='<span data-onclick="'+o+'"></span>';d.body.appendChild(a);o=a.firstChild.getAttribute('data-onclick');var s=(d.querySelector('meta[name=snonce]')||{}).content;var b=d.createElement('script');if(s){b.nonce=s;}b.text='(function(){'+o+'})();';d.body.appendChild(b);return true;}}return false;};T.logout=function(l,c){if(window.SFSessionTimeout){SFSessionTimeout.clearLastPageVisited();}if(arguments.length==1){T.gotoURL(l);}else{var a=Array.prototype.slice.call(arguments);spUrls=a.slice(2);T.requireBusyDialog(function(B){var b=document.createElement("div");b.id="renderLogout";window.document.body.appendChild(b);var d=new B();var t=setTimeout(function(){d.close();g.logoutCore()},5000);g=new T(b.id,l,t,c,spUrls);g.logoutSP();d.open();})}};T.requireBusyDialog=function(c){if(window.sap&&sap.ui&&sap.ui.require){sap.ui.require(['sap/m/BusyDialog'],c);}else{c(function(){this.open=this.close=function(){}});}};T.logoutEditableForm=function(r,a,b,c,d){var s=Array.prototype.slice.call(arguments);s=s.slice(5);T.requireBusyDialog(function(B){var l=document.createElement("div");l.id="renderLogout";window.document.body.appendChild(l);var e=new B();var t=setTimeout(function(){e.close();g.logoutCoreForm()},5000);g=new T("renderLogout",c,t,d,s);g._initFormLogout(r,a,b,c);g.logoutSP();e.open();});};T.updateResponseCount=function(){g.updateResponseCount();};T.navigateAfterLoggingOutFromSPs=function(u){var p=window.pageHeaderJsonData,s,c,a;do{if(!p){alert("WARNING: pageHeaderJsonData global var is unexpectedly not defined!");break;}s=p.spLogoutUrls;if(!s||(s.length<=0)){break;}c=p.companyId;if(!c){alert("WARNING: pageHeaderJsonData.companyId property is unexpectedly not defined!");break;}a=[u,c].concat(s);T.logout.apply(T,a);return;}while(false);T.gotoURL(u);};function T(i,l,t,c,u){this._divId=i;this._init(l,t,c,u);}(function(){var m={_init:function(l,t,c,u){this._logoutUrl=l;this._companyId=c;this._numberOfLogout=0;this._spLogoutFrameList=new Array();this._isLogoutForm=false;this._initFrames(u);this._timeoutHandler=t;var h=[];this.renderHtml(h);var e=document.getElementById(this._divId);if(!e){e=document.createElement("div");e.id="renderLogout";}e.innerHTML=h.join('');},_initFormLogout:function(r,b,c,d){this._isLogoutForm=true;this._redirectTokenParam=r;this._redirectTokenValue=b;this._redirectKeyParam=c;this._redirectKeyValue=d;},_initFrames:function(u){for(var i=0;i<u.length;i++){var s=u[i];var f=new S(s,this._companyId,i);this._spLogoutFrameList.push(f);this._numberOfLogout+=1;}},renderHtml:function(h){for(var i=0;i<this._spLogoutFrameList.length;i++){this._spLogoutFrameList[i].renderHtml(h);}},logoutSP:function(){for(var i=0;i<this._spLogoutFrameList.length;i++){this._spLogoutFrameList[i].submitLogout();}},updateResponseCount:function(){this._numberOfLogout-=1;if(this._numberOfLogout<1){this.stopTimer();if(!this._isLogoutForm){this.logoutCore();}else{this.logoutCoreForm();}}},stopTimer:function(){clearTimeout(this._timeoutHandler);},logoutCore:function(){T.gotoURL(this._logoutUrl);},logoutCoreForm:function(){setField(this._redirectTokenParam,this._redirectTokenValue);setFieldAndSubmit(this._redirectKeyParam,this._redirectKeyValue);}};for(var a in m){T.prototype[a]=m[a];}})();function S(l,c,i){this._init(l,c,i);}(function(){var m={_init:function(l,c,i){this._logoutUrl=l;this._companyId=c;this._formName='spLogoutUrlForm'+i;this._frameName='spLogoutUrlFrame'+i;},renderHtml:function(h){var p=window.pageHeaderJsonData;var b=(p&&p.defaultBaseUrl);if(b&&(window.location.href.indexOf(b)!=0)){b=null;}if(!b){b=(p&&p.baseUrl)||'';}var c=window.ajaxSecKey;h.push('<form name="'+this._formName+'" action="'+b+'/sf/idp/SAML2/slo'+(c?'?_s.crb='+c:'')+'" target="'+this._frameName+'" method="POST">');h.push('<input type="hidden" name="LogoutUrl" value="'+this._logoutUrl+'" />');h.push('<input type="hidden" name="company" value="'+this._companyId+'" />');h.push('</form>');h.push('<iframe name="'+this._frameName+'" src="" width="0px" height="0px" style="visibility: hidden"></iframe>');},submitLogout:function(){document.forms[this._formName].submit();}};for(var a in m){S.prototype[a]=m[a];}})();$.sap.setObject('sap.sf.surj.shell.util.TopNavLogout',T);return(window.TopNavLogout=T);});
