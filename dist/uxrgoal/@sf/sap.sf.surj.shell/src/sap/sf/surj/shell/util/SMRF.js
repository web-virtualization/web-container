sap.ui.define(['jquery.sap.global','./Util','jquery.sap.storage'],function($,U){"use strict";function u(){var a=window.SMRF;var e=window.juic;if(!e){window.juic={Logger:{error:$.sap.log.error},set:$.extend,assert:$.sap.assert};}if(!a){a=window.SMRF={};}if(a.load&&a.load!=_.load){_.loadOriginal=a.load.bind(a);}$.extend(a,_);}function f(F,v){var V=v&&v.DEPS_VERSION_MAP;return F.filter(function(a){return!V||!V[_.normalizeUrl(a)];});}function g(a){var p=/^https?:\/\/[^\/]*(\/.*)$/.exec(a);if(p){p=p[1];}else{p=a;}var P;var e=p;if(P=/^(.*)(?:_dev-snapshot|_[A-Za-z\d+\-=]{32,})\.(css|js)$/.exec(p)){e=P[1]+'.'+P[2];}else if(P=/^(\/ui\/\w+\/\w+)_[\da-f][^\/]*(\/.*)\.(css|js)$/.exec(p)){e=P[1]+P[2]+'.'+P[3];}return e;}function n(a){var p;if(p=/^ajaxservice\:(.*)/.exec(a)){var e=p[1];var P=U.decodeParam(e);var L=P&&(P.legacy=='true');if(p=/^(.*)\?/.exec(e)){e=p[1];}var i;if(p=/^([^\.]*)\.(.*)$/.exec(e)){i=p[1];e=p[2];}if(!i){i='v4';}if(i){a="/ui/"+i+"/js/ajaxservice/"+e+"ASProxy.js";}}return a;}function b(){var a=window.ajaxSecKey;if(a){var S=$.sap.storage('session','_smrf_'+a);return S.isSupported()?S:null;}}function c(F,a,i){i=i!==false;var P=E(i);if(!Array.isArray(F)){return P.reject("aFiles must be an array");}var p=window.pageHeaderJsonData;var r=p&&p.userLocale;var v=F.join(',')+'?useAbs='+(!!a)+(r?('&lang='+encodeURIComponent(r)):'');var G=_._packagePromises[v];if(!i&&G&&G.then){G=null;}if(G){return P.resolve(G);}var S=_.getStorage();var H=S&&S.get(v);if(H){return P.resolve(H);}if(!U.isRunningBaseDomain()){return P.reject("SMRF.load requires base domain");}return _._packagePromises[v]=P.make(function(I,J){function K(R){var Q=false;var T=[];var V=null;var W=[];var X=[];R.split(/\r?\n/).forEach(function(h1){var i1;if(i1=/<link[^>]*href="([^"]*)"/.exec(h1)){W.push(U.ensureBaseDomain(i1[1],a));}else if(i1=/^<script[^>]*src="([^"]*)"/.exec(h1)){var j1=U.ensureBaseDomain(i1[1],a);if(g(j1)==_._smrfScript){V=j1;}else{W.push(j1);}}else if(/^<script[^>]*><!--$/.test(h1)){Q=true;}else if(h1.indexOf("//--></script>")==0){Q=false;}else if(Q){h1&&T.push(h1);}});var Y=['DEPS_TREE','DEPS_VERSION_MAP','IMAGES','RESOURCES','MSGS','dateFormatSymbols','decimalFormatSymbols','firstDayOfWeek'].map(function(h1){var i1={key:h1,value:window[h1]};window[h1]=null;return i1;});if(T.length>0){try{U.dangerouslyEvalScript(T.join("\n"));}catch(e){J(e);}}var Z=Y.reduce(function(h1,i1){var j1=i1.key;h1[j1]=window[j1];window[j1]=i1.value;return h1;},{});var H={files:F,smrfScript:V,variables:Z};w(Z,a);var a1=Z.DEPS_VERSION_MAP=Z.DEPS_VERSION_MAP||{};var b1=Z.DEPS_TREE=Z.DEPS_TREE||{};var c1=[];var d1=[];var e1=F.reduce(function(h1,i1){h1[i1]=true;return h1;},{});W.forEach(function(h1){var i1=g(h1);a1[i1]=h1;if(!_._blacklisted[i1]||e1[i1]){if(/\.css$/.test(h1)){d1.push(h1);}else{c1.push(h1);}}else if(!b1[h1]){var j1=_._hardCodedDeps[i1]||[];j1=j1.reduce(function(j1,k1){var l1=a1[k1];if(l1){j1.push(l1);}return j1;},[]);if(j1.indexOf(h1)<0){j1.push(h1);}b1[h1]=j1;}});H.linearFiles=c1;H.cssFiles=d1;d1.forEach(function(h1){b1[h1]=[h1];});var f1=f(F,Z);if(f1.length>0&&c1.length==0){J("Could not find: "+f1.join(","));}else{if(f1.length>0){var g1=c1[c1.length-1];f1.forEach(function(h1){a1[h1]=g1;});}if(S){S.put(v,H);}if(i){_._packagePromises[v]=H;}I(H);}}function L(e){J('Error '+e.status+' during SMRF package download');}var N=U.ensureBaseDomain(_._packageUrl)+'?'+$.param({js:F.map(n)});if(i){$.ajax({url:N,xhrFields:{withCredentials:true}}).then(K,L);}else{var O=$.ajax({async:false,url:N,xhrFields:{withCredentials:true}});if(O.status==200&&O.responseText){K(O.responseText);}else{L(response);}}});}function d(p,a){var P=E(a);return P.make(function(r,e){var S=p&&p.smrfScript;if(_.loadOriginal){r(p);}else if(S){if(a===false){o(S);u();r(p);return;}if(!_._scriptPromise){_._scriptPromise=P.make(function(r,e){$.sap.includeScript(S,{nonce:U.getCSPScriptNonce()},function(){_._scriptPromise=null;u();r(p);},e);});}_._scriptPromise.then(r.bind(null,p),e);}else{e("SMRF Package does not include "+_._smrfScript);}});}var M={paramRegExpArray:[],getParamRegExp:function(p){var r=this.paramRegExpArray[p];if(!r){r=new RegExp('\\{'+p+'\\}','g');this.paramRegExpArray[p]=r;}return r;},format:function(a){var r=a,p=0,i;if(r&&r.replace){for(i=1;i<arguments.length;i++){r=r.replace(this.getParamRegExp(p++),arguments[i]);}}return r;}};function h(a){var v=this[a];if(arguments.length>1){arguments[0]=v;return M.format.apply(M,arguments);}else{return v;}}function j(p){var v=p&&p.variables;if(v){for(var K in v){var N=v[K];if(N&&typeof N=='object'){var e=window[K]=window[K]||{};for(var F in N){if(!e[F]){e[F]=N[F];}}}else{var e=window[K];if(e==null){window[K]=N;}}}}var a=window.MSGS=window.MSGS||{};if(a&&!a.MessageFormatter){a.MessageFormatter=M;}if(!window.MessageFormatter){var i=window.MessageFormatter=function(){};i.prototype.format=function(){return M.format.apply(M,arguments);};window.sfMessageFormat=new i();}if(!window.jsSFMessages){window.jsSFMessages=a;}if(!a.get){a.get=a.get||h;}}function k(F,p){var v=window.DEPS_VERSION_MAP;var V=v&&v[F];if(!V){v=p&&p.variables&&p.variables.DEPS_VERSION_MAP;V=v&&v[F];}return V||F;}function l(p,a){function e(p){var v=p.variables;var i=v&&v.DEPS_TREE;if(!i){i=v.DEPS_TREE={};}var r=p.cssFiles;var L=p.linearFiles;if(L&&L.length>0){var F=r.concat();L.forEach(function(J){F.push(J);var K=i[J];if(!K&&!document.getElementById(J)){i[J]=F;F=[J];}});}for(var G in i){var F=i[G];var H=g(G);var I;if(/\/ajaxservice\/.*ASProxy_[^\/]*$/.test(G)){I=_._ajaxServiceDeps;}else{I=_._hardCodedDeps[H];}if(I){I=I.map(function(J){return k(J,p)}).filter(function(V){return F.indexOf(V)<0;});if(I&&I.length>0){I.forEach(function(N){if(!i[N]){i[N]=[N];}});F.splice.apply(F,[0,0].concat(I));}}s(F);}return p;}if(a===false){return e(y(p,false));}else{return y(p,true).then(e);}}function s(F){var a=window.DEPS_TREE;if(F&&a){for(var i=F.length-1;i>=0;i--){var e=F[i];var p=a[e];if(p?p.length==0:document.getElementById(e)){F.splice(i,1);}}}}function m(F){var a=window.DEPS_TREE;var e=a&&a[F];var i=document.getElementById(F)!=null||(e&&e.length==0);if(!a){a=window.DEPS_TREE={};}a[F]=[];return i;}function o(F){if(m(F)){return;}$.ajax({url:F,async:false}).then(function(a){U.dangerouslyEvalScript(a);},function(){throw new Error("Error including script: "+F);});}function q(F){if(m(F)){return;}$('<link>').attr({id:F,rel:'stylesheet',type:'text/css',href:F}).appendTo('head');}function t(F,a){var e=[];a=a!==false;var N=f(F,window).filter(function(i){var r=_._smrfVariablePromises[i];if(r){e.push(r);}return!r;});if(!a){var p=c(N,false,false);d(p,false);return j(l(p,false));}if(N.length>0){var P=c(N).then(d).then(l).then(j);N.forEach(function(i){_._smrfVariablePromises[i]=P;});P.catch(function(i){}).then(function(){N.forEach(function(i){_._smrfVariablePromises[i]=null;});});e.push(P);}else if(_._scriptPromise){e.push(_._scriptPromise);}return Promise.all(e);}function w(v,a){if(v&&(!U.isRunningBaseDomain()||a)){['IMAGES','RESOURCES','DEPS_TREE','DEPS_VERSION_MAP'].forEach(function(p){var r=v[p];if(r){$.extend(r,U.ensureBaseDomain(r,a));}});var T=v.DEPS_TREE;if(T){for(var e in T){var N=U.ensureBaseDomain(e,a);if(N!=e){var i=T[e];delete T[e];T[e]=i;}}}}}function x(a){var P=E(a);if(_._overrideAjax!=null){return P.resolve(_._overrideAjax);}return P.make(function(r,e){function i(v){v.initAjaxService();var F=window.AjaxService;r(_._overrideAjax=F&&F.override);}var p='sap/sf/surj/shell/util/DeferredUtil';if(a===false){i(sap.ui.requireSync(p));}else{sap.ui.require([p],i,e);}});};function y(i,a){function e(O){if(O){if(Array.isArray(i)){i=i.filter(z);}else if(i){var p=i.variables&&i.variables.DEPS_TREE;if(p){Object.keys(p).forEach(function(F){if(z(F)){p[F]=p[F].filter(z);}});}var L=i.linearFiles;if(L){i.linearFiles=L.filter(z);}}}return i;}if(a===false){return e(x(false));}else{return x(true).then(e);}}function z(F){return!/\/(ui|js)\/ajaxservice\//.test(n(F));}function A(F,v){if(!v){return t([F]).then(function(){var V=window.DEPS_VERSION_MAP||{};var r=V[F];return r?A(r,{}):'(not found) '+F;});}else if(v[F]){return'(visited) '+F;}else{var a=window.DEPS_TREE||{};var e=a[F];var i;v[F]=true;if(e){if(e.length>1){var p=e.slice(0,e.length-1).map(function(r){return A(r,v);});i={src:F,dependsOn:p.length==1?p[0]:p};}else if(e.length==1&&e[0]==F){i='(leaf node) '+F;}else if(e.length!=0){i='(invalid) '+F;}else{i='(already) '+F;}}else{i='(not found) '+F;}return i;}}function B(v,L,V){if(V[v]){return;}V[v]=true;var a=window.DEPS_TREE;var e=a&&a[v];if(!e){throw new Error("Cannot find deps for: "+v);}e.forEach(function(F){if(F===v){L.push(v);}else{B(F,L,V);}});}function C(a){var L=[];var v={};var V=window.DEPS_VERSION_MAP;a.forEach(function(F){var e=V&&V[F];if(!e){throw new Error("Could not find version for: "+F);}B(e,L,v);});return L;}function D(p){return new Promise(function(r,a){var R='YAHOO.util.Event._ready';if(!$.sap.getObject(R)){p.catch(function(){}).then(function(){var e=$.sap.getObject(R);if(e){$(function(){e();r();});}else{r();}});}else{r();}});}function E(e){function p(a){return a;}function r(R){if(R instanceof Error){throw R;}else{throw new Error(R);}}return e===false?{make:function(P){var R;P(function(v){R=v;},r);return R;},all:p,resolve:p,reject:r}:{make:function(P){return new Promise(P);},all:Promise.all.bind(Promise),resolve:Promise.resolve.bind(Promise),reject:Promise.reject.bind(Promise)};}var _={_scriptPromise:null,_smrfVariablePromises:{},_loadPromises:{},_packagePromises:{},_packageUrl:'/xi/ui/commonshell/pages/smrf.xhtml',_smrfScript:'/ui/smrf/js/smrf.js',_ajaxServiceDeps:['/ui/ajaxservice/js/engine.js','/ui/ajaxservice/js/AjaxService.js'],_hardCodedDeps:{"/ui/extlib/yui/js/animation/animation.js":["/ui/extlib/yui/js/yahoo-dom-event/yahoo-dom-event.js"],"/ui/extlib/yui/js/connection/connection.js":["/ui/extlib/yui/js/yahoo-dom-event/yahoo-dom-event.js"],"/ui/extlib/yui/js/autocomplete/autocomplete.js":["/ui/extlib/yui/js/yahoo-dom-event/yahoo-dom-event.js"],"/ui/ajaxservice/js/AjaxService.js":["/ui/ajaxservice/js/engine.js"]},_blacklisted:["/ui/ajaxservice/js/AjaxService.js","/ui/ajaxservice/js/engine.js","/ui/extlib/XMLHttpRequest/XMLHttpRequest.js","/ui/perflog/js/perflog.js"].reduce(function(a,e){a[e]=true;return a;},{}),load:function(F,a){if(Array.isArray(F)){if(a&&typeof a.callback=='function'){a=a.callback.bind(null,a.argument);}else if(typeof a!='function'){a=function(){}}_.loadPromise(F).then(a).catch(function(e){window.console&&console.error(e);});}else{throw new Error("You must pass an array");}},loadSync:function(F){t(F,false);C(F).forEach(function(a){switch(/\.(\w+)$/.exec(a)[1]){case'css':q(a);break;case'js':o(a);break;}});},loadPromise:function(F){if(typeof F=='string'){F=[F];}var p=y(F).then(function(F){u();var P=[];F=F.filter(function(a){var p=_._loadPromises[a];if(p){P.push(p);return false;}return true;});if(F.length>0){var p=new Promise(function(r,a){t(F).then(function(){_.loadOriginal(F,r);},a);});F.forEach(function(a){_._loadPromises[a]=p;});P.push(p);}return Promise.all(P);});D(p);return p;},getStorage:b,upgrade:u,normalizeUrl:n,getSMRFPackage:c,updateSMRFVariables:t,adjustSMRFPackage:l,getUnversionedPath:g,getDepsTree:A,filterAjaxProxies:y,fixYahooDomReady:D};u();jQuery.sap.setObject('sap.sf.surj.shell.util.SMRF',_);_.__scriptAttributes={nonce:U.getCSPScriptNonce()};return _;});
