sap.ui.define('sap/sf/surj/shell/util/ProxyUtil',['jquery.sap.global','sap/m/Dialog','sap/m/Label','sap/m/Button','sap/sf/surj/shell/controls/SearchInput','sap/sf/surj/shell/util/DeferredUtil'],function($,D,L,B,S,a){function p(u){if(window.TopNavLogout){var b=$.sap.getObject('pageHeaderJsonData.defaultBaseUrl');if(b&&(window.location.href.indexOf(b)!=0)){b=null;}if(!b){b=$.sap.getObject('pageHeaderJsonData.baseUrl')||'';}var c={fbacme_o:'options',opt_os:'proxy',fbproxy_delegator:u,fbproxy_sel_delegator_btn:'Go'};var U=b+'/acme?'+$.param(c);var C=window.ajaxSecKey;if(C){U+='&_s.crb='+C;}window.TopNavLogout.navigateAfterLoggingOutFromSPs(U);}else{sap.ui.require(['sap/sf/surj/shell/util/TopNavLogout'],function(){if(window.TopNavLogout){p(u);}else{$.sap.log.error('Could not load TopNavLogout, proxy now impossible');}});}}var r=sap.ui.getCore().getLibraryResourceBundle('sap.sf.surj.shell.i18n');var d,s,o;var P={showDialog:function(){if(!d){s=new S({alwaysBottom:true,searchType:'jsup',settings:{findtype:'proxy'},liveChange:function(){o=null;s.setValueState('None');},itemSelected:function(e){o=e.getParameter('selectedItem');s.setValueState('None');}});d=new sap.m.Dialog('bizXProxyDialog',{title:r.getText('PROXY_MODULE_AUTOCOMPLETE_TITLE'),content:[new sap.m.Label({text:r.getText('PROXY_MODULE_AUTOCOMPLETE_LABEL'),labelFor:s}),s],beginButton:new sap.m.Button({text:r.getText('COMMON_Cancel'),press:function(){d.close();}}),endButton:new sap.m.Button({type:'Emphasized',text:r.getText('COMMON_Ok'),press:function(){if(o){a.invokeAjaxService({serviceName:'guidedTourController',serviceMethod:'getProxyTimesforUser',arguments:[o.UserId]}).then(function(c){console.log('Callback of check proxy time',c);if(c){s.setValueStateText(c);s.setValueState('Error');s.focus();}else{p(o.UserId);d.close();}},function(m,e){$.sap.log.error(e);});}else{s.setValueStateText(r.getText('PROXY_MODULE_AUTOCOMPLETE_ERROR_MSG'));s.setValueState('Error');s.focus();}}})});d.open();}else{o=null;s.setValueState('None');s.setValue('');d.open();}},proxyTo:p};window.proxySearchController={show:P.showDialog};$.sap.setObject('sap.sf.surj.shell.util.ProxyUtil',P);return P;});
