sap.ui.define("sap/sf/surj/shell/util/FormGenerationUtil",["sap/base/util/isEmptyObject","sap/m/Column","sap/m/ColumnListItem","sap/m/Label","sap/m/Table","sap/m/Text","sap/ui/core/ListItem","sap/ui/layout/form/FormElement","sap/ui/mdc/Field","sap/ui/mdc/enum/FieldDisplay","sap/ui/mdc/enum/EditMode","sap/ui/mdc/field/InParameter","sap/ui/mdc/field/FieldValueHelp","sap/ui/mdc/field/FieldValueHelpMTableWrapper","sap/ui/mdc/field/ListFieldHelp","sap/ui/mdc/field/OutParameter","sap/ui/model/odata/v4/ODataModel"],function(a,C,b,L,T,c,d,F,e,f,E,I,g,h,j,O,k){var l={createFormElements:function(o){return new Promise(function(r,i){var s=o.entityType;var m=o.metaModel;var S=o.serviceUrl;if(!s){i("There is no entity type specified!");}else if(!m){if(!S){i("There is no service url provided to create the odata v4 model!");}else{m=new k({serviceUrl:S,annotationURI:o.annotationURI||S+"/Annotations.xml",synchronizationMode:"None"}).getMetaModel();}}var n=s.split(".")[0];m.requestObject("/"+s).then(function(D){var p=Object.entries(D);var q=[];p.forEach(function(t){var N=t[0];var u=t[1];if(!N.startsWith("$")){var A=m.getObject("/"+s+"/"+N+"@");if(!a(A)){q.push(l.createFormElement(N,u,A,m,n));}}});r(q);});});},editFormatter:function(){var s=E.Editable;for(var i=0;i<arguments.length;i++){if(arguments[i]===false||arguments[i]===E.ReadOnly){s=E.ReadOnly;break;}}return s;},createFormElement:function(n,t,A,m,s,i){var o=t.$Type.split(".")[1];var p,D,q=null,r={};if(i){r.editModeFormatter={parts:i,formatter:this.editFormatter}}var u=Object.keys(A);u.forEach(function(v){var w=v.split("#");var x=A[v];switch(w[0]){case"@com.sap.vocabularies.Common.v1.Text":q=l.parseTextAnnotation(x);break;case"@com.sap.vocabularies.UI.v1.TextArrangement":D=l.parseTextArrangementAnnotation(x);break;case"@com.sap.vocabularies.UI.v1.ConnectedFields":var R=l.parseConnectedFieldsAnnotation(x);q=R.additionValueFormatter;D=R.display;break;case"@com.sap.vocabularies.Common.v1.ValueList":if(A["@com.sap.vocabularies.Common.v1.ValueListWithFixedValues"]){p=l.parseFixedValueListAnnotation(x);}else{p=l.parseValueListAnnotation(x,m,s);}break;case"@com.sap.vocabularies.Common.v1.FieldControl":r=l.parseFieldControlAnnotation(x);break;default:break;}});return new F({label:new L({text:A["@com.sap.vocabularies.Common.v1.Label"]}),fields:[new e({required:r.requiredFormatter?r.requiredFormatter:false,value:"{path: '"+n+"', type: 'sap.ui.model.odata.type."+o+"' "+l.getFormatOptions(o,t)+(n.includes("/")?", parameters: { $$noPatch: true }":"")+"}",additionalValue:q?q:"",display:D,fieldHelp:p,editMode:r.editModeFormatter?r.editModeFormatter:E.Editable,visible:r.visibleFormatter?r.visibleFormatter:true,delegate:{name:"sap/ui/mdc/odata/v4/FieldBaseDelegate",payload:{}}}).addDependent(p)]});},getFormatOptions:function(t,o){var s="";if(t=="TimeOfDay"){s=", formatOptions: {style: 'short'}, targetType: 'string'"}else if(t==="Decimal"){s=", formatoptions: {maxFractionDigits: "+o.$Scale+", decimalSeparator: '.'}, constraints: {precision: "+o.$Precision+", scale: "+o.$Scale+"}"}return s;},parseTextAnnotation:function(t){return{path:t.$Path};},parseTextArrangementAnnotation:function(t){var D=t.$EnumMember.split("/")[1];switch(D){case"TextFirst":D=f.DescriptionValue;break;case"TextLast":D=f.ValueDescription;break;case"TextSeparate":D=f.Value;break;case"TextOnly":D=f.Description;break;default:break;}return D;},parseConnectedFieldsAnnotation:function(o){var r={display:f.Description};var p=[];var i={};var m=Object.entries(o.Data);m.forEach(function(n,q){p.push(n[1].Value.$Path);i["{"+n[0]+"}"]=q;});var t=o.Template;r.additionValueFormatter={parts:p,formatter:function(){var n=arguments;return t.replace(/\{\w+\}/g,function(q){return n[i[q]];});}};return r;},parseValueListAnnotation:function(v,m,s){var p=v.CollectionPath;var P=v.Parameters;var i=[],o=[],V={},n;P.forEach(function(x){var y=x.$Type;V[x.ValueListProperty]=m.getObject("/"+s+"."+p+"/"+x.ValueListProperty+"@com.sap.vocabularies.Common.v1.Label");switch(y){case"com.sap.vocabularies.Common.v1.ValueListParameterInOut":i.push(new I({value:"{"+x.LocalDataProperty.$PropertyPath+"}",helpPath:x.ValueListProperty}));o.push(new O({value:"{"+x.LocalDataProperty.$PropertyPath+"}",helpPath:x.ValueListProperty}));break;case"com.sap.vocabularies.Common.v1.ValueListParameterIn":i.push(new I({value:"{"+x.LocalDataProperty.$PropertyPath+"}",helpPath:x.ValueListProperty}));break;case"com.sap.vocabularies.Common.v1.ValueListParameterOut":o.push(new O({value:"{"+x.LocalDataProperty.$PropertyPath+"}",helpPath:x.ValueListProperty}));break;default:break;}});var q=v.SearchSupported?"*"+Object.keys(V).join(",")+"*":"";var t=v.Label;var r=[],u=[];var w=Object.entries(V);w.forEach(function(x){r.push(new C({header:new L({text:x[1]})}));u.push(new c({text:"{"+x[0]+"}"}));});n=new g({filterFields:q,title:t,inParameters:i,outParameters:o,content:new h({table:new T({width:"40rem",columns:r,items:{path:"/"+p,template:new b({cells:u}),templateShareable:true}})}),delegate:{name:"sap/ui/mdc/odata/v4/FieldValueHelpDelegate",payload:{}}}).attachOpen(function(x){});return n;},parseFixedValueListAnnotation:function(v){var p=v.CollectionPath;var P=v.Parameters;var i,s,o;P.forEach(function(m){var t=m.$Type;if(t=="com.sap.vocabularies.Common.v1.ValueListParameterOut"){i=m.ValueListProperty;}else if(t=="com.sap.vocabularies.Common.v1.ValueListParameterDisplayOnly"){s=m.ValueListProperty;}});o=new j({items:{path:"/"+p,template:new d({text:"{"+s+"}",key:"{"+i+"}"}),templateShareable:true}});return o;},parseFieldControlAnnotation:function(o){var s,i={};if(o.$If){s=o.$If[0].$Path;var m=o.$If[1].$EnumMember.split("/")[1];if(m==="Mandatory"){i.requiredFormatter={path:s,formatter:function(p){return p;}};}else if(m==="Optional"){i.requiredFormatter={path:s,formatter:function(p){return!p;}};}else if(m==="ReadOnly"){var n={path:s,formatter:function(p){return p?E.ReadOnly:E.Editable;}};if(i.editModeFormatter){i.editModeFormatter.parts.push(n);}else{i.editModeFormatter=n;}}else if(m==="Inapplicable"||m==="Hidden"){i.visibleFormatter={path:s,formatter:function(p){return!p;}};}}else if(o.$Path){s=o.$Path;i.requiredFormatter={path:s,type:"sap.ui.model.odata.type.Boolean",formatter:function(v){return v===7;}};i.editModeFormatter={path:s,formatter:function(v){return v===1?E.ReadOnly:E.Editable;}};i.visibleFormatter={path:s,type:"sap.ui.model.odata.type.Boolean",formatter:function(v){return v!==0;}};}return i;}};$.sap.setObject('sap.sf.surj.shell.util.FormGenerationUtil',l);return l;});
