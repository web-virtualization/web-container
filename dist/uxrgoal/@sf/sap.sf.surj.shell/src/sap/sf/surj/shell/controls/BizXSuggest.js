sap.ui.define(['jquery.sap.global','sap/ui/Device','sap/m/Suggest','../util/A11yPreferences'],function($,D,S,A){"use strict";function B(p){var a=this;var u=B.USE_DIALOG;var P=p;var b=null;this._super.apply(this,arguments);s(this,{getPicker:function(){return b},getList:function(){if(b){return b.getContent()[0];}},setSelected:function(i,r){if(this.getHighlightedExternalSearch()){return;}var c=this._super(i,r);if(r){var o=this.getSelectedSuggestionItem();var e=o&&o.$();if(e&&e.length){var l=this.getList();var d=l&&l.getParent();var f=d&&d.getScrollDelegate();var C=f._$Container;if(C&&C.length){var g=C.offset();var h=e.offset();var j=g.top+C.height();var k=h.top+e.height();var m=0;if(k>j){m=k-j;}else if(h.top<g.top){m=h.top-g.top;}if(m!=0){var x=f.getScrollLeft();var y=f.getScrollTop()+m;f.scrollTo(x,y,0);if(f._fnScrollLoadCallback){f._fnScrollLoadCallback();}}}}if(o){P.quickcardRequest({suggestionItem:o});}}else if(c<0){var n=this.getList();n&&n.$().children("li").eq(c).removeClass("sapMSelectListItemBaseSelected").attr("aria-selected","false");}return c;},getSelectedSuggestionItem:function(){var i=this.getSelectedItemIndex();var I=this.getList().getItems();if(i>=0&&Array.isArray(I)&&I.length>i){return I[i];}},getSelectedItemIndex:function(){return this.getList().getSelectedItemIndex();},setHighlightedExternalSearch:function(f){this.bFooterHighlighted=f;if(this._externalSearchLink){this._externalSearchLink[f?'addStyleClass':'removeStyleClass']('surjFocused');}},getHighlightedExternalSearch:function(){return this.bFooterHighlighted;},isExternalSearchVisible:function(){return this._externalSearchLink&&this._externalSearchLink.getVisible();},open:function(){var P=p;this._super();if(!b){var c;if(u){c=$('.sapMDialog');}else{c=$('.sapMSltPicker');}var l=c.length;if(l>0){b=sap.ui.getCore().byId($(c[l-1]).attr('id'));b.addStyleClass('bizXSuggestPicker');if(A.isLowVisionEnabled()){b.addStyleClass('globalLowVisionSupport');b.addStyleClass(A.getLowVisionType());}b.removeDelegate(b.aDelegates[0].oDelegate);b.attachAfterClose&&b.attachAfterClose(function(){P.fireAfterSuggestClose();});if(u){var C=b.getCustomHeader();C.removeContentLeft(0);b.addStyleClass('bizXSuggestDialog');sap.ui.require(['sap/sf/surj/shell/controls/BizXSearchField'],function(e){var o=new e({showRefreshButton:true,showSearchButton:false,showSearchType:'{universalSearch>/searchTypeVisible}',transitiveText:'{universalSearch>/transitiveAction/actionLabel}',placeholder:'{universalSearch>/placeholder}',pending:'{universalSearch>/pending}',liveChange:function(E){var v=E.getParameter("newValue");P.setValue(v);P.fireLiveChange({newValue:v});P.fireSuggest({suggestValue:v});a.update();},search:function(E){if(!E.getParameter("clearButtonPressed")){b.close();}}});$.each(['pressSearchType','reset'],function(i,E){$.each(P.mEventRegistry[E]||[],function(j,f){o.attachEvent(E,f.oData,f.fFunction,f.oListener);});});C.addContentLeft(o);});}else{var w=P.$().outerWidth();b.setContentWidth(w+'px');var L=a._externalSearchLink=new sap.m.Link({press:function(){P.fireExternalSearch();},visible:'{universalSearch>/externalSearchVisible}',text:'{universalSearch>/externalSearchText}'}).addStyleClass('bizXSuggestExternalSearch');if(a.bFooterHighlighted){L.addStyleClass('surjFocused');}b.setFooter(a._externalSearchLink);b.addEventDelegate({onmouseup:function(e){P.__ignoreBlur=false;},onmousedown:function(e){P.__ignoreBlur=true;e.preventDefault();},onAfterRendering:function(){var e=b.getDomRef();e.style.maxWidth=w+'px';}});var d=function(){b.close();};b.attachAfterOpen(function(){window.addEventListener('scroll',d);P.$('I').attr('aria-owns',b.getId());});b.attachBeforeClose(function(){window.removeEventListener('scroll',d);P.$('I').removeAttr('aria-owns');});}}}}});}B.USE_DIALOG=D.system.phone;B.prototype=new S();B.prototype._super=S;$.sap.setObject('sap.sf.surj.shell.controls.BizXSuggest',B);function s(t,i){$.each(i,function(a,m){var o=m;if(typeof m=='function'&&F.test(m)){var f=t[a];o=function(){var _=t._super;var r;t._super=f;try{r=m.apply(t,arguments);}finally{t._super=_;}return r;}}t[a]=o;});}var F=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;return B;});
