sap.ui.define('sap/sf/surj/shell/util/AjaxServiceError',['sap/m/BusyIndicator','sap/m/Dialog','sap/m/List','sap/m/StandardListItem','sap/m/TextArea','sap/m/Button','sap/ui/core/HTML','sap/ui/core/InvisibleText','sap/sf/surj/shell/controls/Container','sap/sf/surj/shell/util/DeferredUtil','jquery.sap.global'],function(B,D,L,S,T,a,H,I,C,b,$){var r=sap.ui.getCore().getLibraryResourceBundle('sap.sf.surj.shell.i18n');var c=sap.ui.getCore();var A={forceAjaxSearchResultKey:null,generalError:function(e,d){if(e&&d){if(this.forceAjaxSearchResultKey){d.fingerprint=this.forceAjaxSearchResultKey;}var u=encodeURIComponent(d.errorId);var f=encodeURIComponent(d.fingerprint);var g=encodeURIComponent(d.timestamp);var h='sap.sf.surj.shell.util.AjaxServiceError.gotoSupportDocSearchUrl(\''+u+'\',\''+f+'\',\''+g+'\')';var l=r.getText('COMMON_ERROR_FIND_ARTICLE',h);var t=r.getText('COMMON_Error');var s=(d.customizedBody?("<span>"+d.customizedBody+' </span><br />'):'');s+=r.getText('COMMON_AjaxService_Error_Try_Search',f);var i=r.getText('COMMON_AjaxService_Show_More');var j=new H('ajaxServiceErrorShowMore',{content:i,preferDOM:false});var k=new I({text:r.getText('COMMON_AjaxService_Error_Details_Description')}).toStatic();var m=new T('ajaxServiceErrorDetailCode',{value:e,rows:1,width:'500px',height:'100px',editable:false,visible:false,ariaLabelledBy:k});var o=[new C('docSearchContainer',{content:[new H('promptUserText',{content:s,preferDOM:false}),new C('docSearch',{content:[new B('ajaxServiceErrorSearchBusyIndicator',{visible:false}).addStyleClass('ajaxServiceErrorSearchBusyIndicator')]})]}),j,m];var t=r.getText('COMMON_Error');this.useUI5Dialog(o,t);}else{if(e){var n=r.getText('COMMON_AJAX_EXCEPTION_CONVERTER_ERROR');prompt(n,e);}else{alert(r.getText('COMMON_AJAX_DEFAULT_ERROR'));}}},useUI5Dialog:function(o,t){var d=c.byId('ajaxErrorDialog');if(!d){d=new D('ajaxErrorDialog',{title:t,contentWidth:'600px',resizable:false,content:o,endButton:new a({text:r.getText('COMMON_Ok')||'OK',type:'Emphasized',press:function(e){e.getSource().getParent().close();}.bind(this)}),afterClose:function(){this.destroy();}}).addStyleClass('globalAjaxErrDialog');}if(!d.isOpen()){d.open();}},showErrorInfo:function(){c.byId('ajaxServiceErrorDetailCode').setVisible(true);c.byId('ajaxServiceErrorShowMore').setVisible(false);},invokeKBSearch:function(k){var d=c.byId('ajaxServiceErrorSearchBusyIndicator');d.setVisible(true);b.invokeAjaxService({type:'ajaxService',module:'inproductsupport',serviceName:'inProductSupportController',serviceMethod:'getKnowledgeBaseSearchResult',arguments:[k]}).then(function(e){d.setVisible(false);failed=true;if(e&&e.data){var o=JSON.parse(e.data);if(o.status=='success'){var f=o.result.results['results'];if(f.length>0){var s=r.getText('COMMON_AjaxService_Found_KBA');c.byId('promptUserText').setContent(s);var l=new L('docLinks').addStyleClass('sapUiSizeCompact');for(var i=0;i<f.length&&i<2;i++){var g=f[i];l.addItem(new sap.m.StandardListItem({title:g['TITLE'],description:g['DESCRIPTION'],info:g['USERURL'],type:"Navigation",press:function(E){var u=E.getSource().getInfo();if(u){window.open(u,'_blank','location=1,menubar=1,personalbar=1,resizable=1,scrollbars=1,status=1,toolbar=1');}}}));}l.placeAt('docSearch');failed=false;}else{failed=true;}}}}).done(function(e){d.setVisible(false);if(failed){c.byId('docSearch').setVisible(false);var s=r.getText('COMMON_AjaxService_NO_RESULT');c.byId('promptUserText').setContent(s);this.showErrorInfo();}}).fail(function(e){failed=true;});}};A.gotoSupportDocSearchUrl=function(e,f,t){var d=this.getSupportDocSearchUrl(f);window.open(d,'_blank','location=1,menubar=1,personalbar=1,resizable=1,scrollbars=1,status=1,toolbar=1');A.postLogForError(e,f,t);};A.getSupportDocSearchUrl=function(f){var s=f||'';return'https://search.sap.com/search.html?t='+encodeURIComponent(s.trim())+'%20LOD-SF';};A.postLogForError=function(u,d,e){var p=window.pageHeaderJsonData;var f=(p&&p.companyId);if(!f){return;}var g=new XMLHttpRequest();var l='/public/theme-api/info/'+encodeURIComponent(f)+'?action=KBAFingerprint';if(u){l+='&errorId='+u;}if(d){l+='&fingerprint='+d;}if(e){l+='&timestamp='+e;}g.open('GET',l,true);g.send(null);};$.sap.setObject('sap.sf.surj.shell.util.AjaxServiceError',A);return A;});
