jQuery.sap.declare("sap.sf.surj.shell.controls.BizXSearchField");jQuery.sap.require("sap.sf.surj.shell.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.sf.surj.shell.controls.BizXSearchField",{metadata:{library:"sap.sf.surj.shell"}});sap.ui.define('sap/sf/surj/shell/controls/BizXSearchField',['jquery.sap.global','sap/m/SearchField','sap/ui/Device','sap/ui/core/InvisibleText','sap/sf/surj/shell/controls/BizXSuggest','sap/sf/surj/shell/util/Logger','sap/ui/events/KeyCodes','jquery.sap.encoder'],function($,S,D,I,B,L,K,E){"use strict";function o(s){if(s.getEnableSuggestions()){var f=!s._oSuggest;if(f){var a=new B(s);s._oSuggest=a;}s._oSuggest.open();f&&s.fireScrollDelegateAvailable({scrollDelegate:s._oSuggest.getPicker().getScrollDelegate()});}}return S.extend('sap.sf.surj.shell.controls.BizXSearchField',{metadata:{library:'sap.sf.surj.shell',properties:{a11yLabel:'string',resetOnBlur:'boolean',showSearchType:'any',searchTypeAriaLabel:'string',searchTypeTooltip:'string',transitiveText:'string',pending:'boolean',enableExternalSearch:'boolean',a11yAnnouncement:'string'},events:{reset:{},pressSearchType:{},scrollDelegateAvailable:{},suggestionItemSelected:{},externalSearch:{},quickcardRequest:{},focusQuickcard:{},highlightExternalSearch:{},afterSuggestClose:{}}},renderer:function(r,s){if(!s.getVisible()){return;}r.addClass('bizXSF');if(s.getShowSearchType()){r.addClass('bizXSFHasST');}if(s.getTransitiveText()){r.addClass('bizXSFHasTT');}if(s.getPending()){r.addClass('bizXSFP');}var p=s.getPlaceholder(),v=s.getValue(),w=s.getProperty('width'),i=s.getId(),b=s.getShowRefreshButton(),a=s.getShowSearchButton(),A={};r.write('<div');r.writeControlData(s);if(w){r.writeAttribute('style','width:'+w+';');}r.addClass('sapMSF');if(v){r.addClass('sapMSFVal');}if(!s.getEnabled()){r.addClass('sapMSFDisabled');}r.writeClasses();var t=s.getTooltip_AsString();if(t){r.writeAttributeEscaped('title',t);}r.write('>');r.write('<form method="post" action="javascript:void(0);"');r.writeAttribute('id',i+'-F');r.addClass('sapMSFF');if(!a){r.addClass('sapMSFNS');}else if(b){r.addClass('sapMSFReload');}else{r.addClass('sapMSFSBNR');}r.writeClasses();r.write('>');r.write('<div class="bizXSFB bizXSFSI"></div>');r.write('<span class="bizXSFTT"></span>');if((!s._hasPlacehoder&&!s._hasPlaceholder)&&p){r.write('<label ');r.writeAttribute('id',i+'-P');r.writeAttribute('for',s.getReferenceId());r.addClass('sapMSFPlaceholder');r.writeClasses();r.write('>');r.writeEscaped(p);r.write('</label>');}r.write('<input type="search" autocorrect="off" autocomplete="off"');r.writeAttribute('id',s.getReferenceId());r.addClass('sapMSFI');if(D.os.android&&D.os.version>=4&&D.os.version<4.1){r.addClass('sapMSFIA4');}r.writeClasses();if(s.getEnableSuggestions()&&D.system.phone){r.writeAttribute('readonly','readonly');}if(!s.getEnabled()){r.writeAttribute('disabled','disabled');}if(p){r.writeAttributeEscaped('placeholder',p);}if(s.getMaxLength()){r.writeAttribute('maxLength',s.getMaxLength());}if(v){r.writeAttributeEscaped('value',v);}if(s.getEnabled()&&b){if(s._a11yText){var c=s._a11yText.getId();A.describedby={value:c,append:true};}}if(p){A.label=p;}r.writeAccessibilityState(s,A);r.write('>');r.write('<div');r.writeAttribute('id',s.getId()+'-a11yAnnouncement');r.addClass('sapUiPseudoInvisibleText');r.writeClasses();r.writeAttribute('aria-live','assertive');r.write('></div>');if(s.getEnabled()){r.write('<div');r.writeAttribute('id',s.getId()+'-reset');r.addClass('sapMSFR');r.addClass('sapMSFB');if(D.browser.firefox){r.addClass('sapMSFBF');}if(!a){r.addClass('sapMSFNS');}r.writeClasses();r.write('></div>');if(a){r.write('<div');r.writeAttribute('id',s.getId()+'-search');r.addClass('sapMSFS');r.addClass('sapMSFB');if(D.browser.firefox){r.addClass('sapMSFBF');}r.writeClasses();if(s.getRefreshButtonTooltip()){r.writeAttributeEscaped('title',s.getRefreshButtonTooltip());}r.write('></div>');}if(s.getShowSearchType()){r.write('<button id="',s.getId(),'-searchType" class="bizXSFB bizXSFST"');var d=s.getSearchTypeAriaLabel();if(d){r.write(' aria-label="');r.writeEscaped(d);r.write('"');}var e=s.getSearchTypeTooltip();if(e){r.write(' title="');r.writeEscaped(e);r.write('"');}r.write(' data-help-id="bizxHeaderSearchType" type="button"></button>');}}r.write('</form>');r.write('</div>');},getReferenceId:function(){return this.getId()+'-I';},onkeydown:function(e){var k=e.keyCode;if(k==K.BACKSPACE&&this.getValue()==''){this.fireReset();}if(k==K.F6&&this._oSuggest&&this._oSuggest.isExternalSearchVisible()){e.preventDefault();}},onkeyup:function(e){var s=e.target;var a=this.$('searchType');var k=e.keyCode;if(k==K.ENTER||k==K.SPACE){if(s.id==this.getId()+'-searchType'){e.preventDefault();this.firePressSearchType({target:s});}}if(k==K.F6&&this._oSuggest&&this._oSuggest.isExternalSearchVisible()){e.preventDefault();this._pressedF6();}if(s.id==this.getReferenceId()){if(k==K.ESCAPE){e.preventDefault();this._pressedEscape();}}if(e.ctrlKey&&e.shiftKey&&k==49){e.preventDefault();this._pressedCtrlShift1();}},onsapenter:function(e){var s=e.target;if(s.id==this.getReferenceId()){e.preventDefault();this._pressedEnter();}},fireSearch:function(p){var r=S.prototype.fireSearch.apply(this,arguments);if(p&&p.suggestionItem){this.fireSuggestionItemSelected({selectedItem:p.suggestionItem});}return r;},_pressedEnter:function(){if(this._oSuggest){var i=this._oSuggest.getSelected();if(i>=0){this.fireSuggestionItemSelected({selectedItem:this.getSuggestionItems()[i]});}else if(this._oSuggest.getHighlightedExternalSearch()||(this.getEnableExternalSearch()&&!this._oSuggest.isExternalSearchVisible())){this.fireExternalSearch();}else{this._oSuggest.setSelected(0,false);}}else if(this.getEnableExternalSearch()){this.fireExternalSearch();}},_pressedEscape:function(){this.fireReset();},_pressedCtrlShift1:function(){this.fireFocusQuickcard();},_pressedF6:function(){if(this._oSuggest.getHighlightedExternalSearch()){var i=this._iLastSelectedIndex;this._oSuggest.setHighlightedExternalSearch(false);this._oSuggest.setSelected(i,false);if(i>=0){this.fireQuickcardRequest({suggestionItem:this.getSuggestionItems()[i]});}}else{this._iLastSelectedIndex=this._oSuggest.getSelected();this._oSuggest.setSelected(-1);this._oSuggest.setHighlightedExternalSearch(true);this.fireHighlightExternalSearch();}},setA11yAnnouncement:function(a){var i='a11yAnnouncement';this.setProperty(i,a,true);if(this._liveAnnounceTimeout!=null){clearTimeout(this._liveAnnounceTimeout);}var t=this;var e=this.$(i);if(a){L.info('Announcing: '+a);e.text(a);this._liveAnnounceTimeout=setTimeout(function(){t._liveAnnounceTimeout=null;e.text('');},1000);}else{e.text('');}},quickcardRequest:function(c){this.fireQuickcardRequest(c);},_fireChangeEvent:function(){if(this.getVisible()){return S.prototype._fireChangeEvent.apply(this,arguments);}},ontouchend:function(e){if(e.originalEvent.button===2){return;}var s=e.target;if($(s).hasClass('sapMSFF')||$(s).hasClass('bizXSFSI')){this.focus();}if(s.id==this.getId()+"-reset"){var b=!this.getValue();this.clear({clearButton:true});var a=document.activeElement;if((D.system.desktop||b||/(INPUT|TEXTAREA)/i.test(a.tagName)||a===this._resetElement&&this._active===this._inputElement)&&(a!==this._inputElement)){this._inputElement.focus();}this.fireSuggest({suggestValue:''});}else if(s.id==this.getId()+'-searchType'){this.firePressSearchType({target:s});}else{S.prototype.ontouchend.apply(this,arguments);}},onmouseover:function(e){var a=$(e.toElement);if(a.hasClass('bizXSFST')){this.$('F').removeClass('hover');}else if(a.closest('.sapMSFF').length>0){this.$('F').addClass('hover');}},onmouseout:function(e){if($(e.toElement).closest('#'+this.getId()).length==0){this.$('F').removeClass('hover');}},onFocus:function(){if(this.__ignoreBlur){return;}S.prototype.onFocus.apply(this,arguments);},onBlur:function(){if(this.__ignoreBlur){return;}S.prototype.onBlur.apply(this,arguments);},onfocusin:function(e){if(e.target.tagName=='INPUT'){if(this.__ignoreBlur){return;}var t=this;var a=this.$();var O=a.css('width');S.prototype.onFocus.apply(this,arguments);this._animateToCurrentWidth(a,O).done(function(){if(t.getEnableSuggestions()){t.suggest(true);}});}},onfocusout:function(e){if(e.target.tagName=='INPUT'){if(this.__ignoreBlur){this.focus();return;}var a=this.$();var O=a.css('width');S.prototype.onBlur.apply(this,arguments);this._animateToCurrentWidth(a,O);if(this.getResetOnBlur()){this.fireReset();}var t=this;setTimeout(function(){if(window.BizXHeaderController&&!BizXHeaderController._quickcardFocused){t.suggest(false);}},10);}},suggest:function(s){if(this.getEnableSuggestions()){s=s===undefined||!!s;if(s&&(this.getSuggestionItems().length||D.system.phone)){o(this);}else{S.prototype.suggest.call(this,s);}}return this;},setA11yLabel:function(a){this.setProperty('a11yLabel',a,true);if(!this._a11yText){this._a11yText=new I().toStatic();this._a11yText.setParent(this);}this._a11yText.setText(a);},setResetOnBlur:function(r){this.setProperty('resetOnBlur',r,true);},setPending:function(p){this.setProperty('pending',p,true);this.$()[p?'addClass':'removeClass']('bizXSFP');},setTransitiveText:function(t){this.setProperty('transitiveText',t,true);var e=this.$();e[t?'addClass':'removeClass']('bizXSFHasTransitive');var T=$('.bizXSFTT',e).text(t);$('.sapMSFI',e).css({width:t?'calc(100% - '+T.outerWidth()+'px)':'100%'});},setPlaceholder:function(p){this.$('P').text(p);this.$('I').attr('placeholder',p);this.setProperty('placeholder',p,true);},setEnableSuggestions:function(e){this.setProperty('enableSuggestions',e,true);},isUseDialog:function(){return B.USE_DIALOG;},_animateToCurrentWidth:function(e,O){if(this.mAnimDfd){this.mAnimDfd.reject();}var d=$.Deferred();var n=e.css('width');if(n!=O){this.mAnimDfd=d.fail(function(){e.stop(true,true);});var t=this;e.css('width',O).animate({width:n},{complete:function(){e.css('width','');t.mAnimDfd=null;d.resolve();}});}else{d.resolve();}return d.promise();}});});
